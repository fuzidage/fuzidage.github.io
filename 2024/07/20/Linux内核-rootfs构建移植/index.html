<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
  
  <title>Linux内核-rootfs构建移植 | Hexo</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
  <meta name="description" content="1 根文件系统的引入 2 根文件系统的组成 2.1 &#x2F;bin 目录 2.2 &#x2F;dev 目录 2.3 &#x2F;etc 目录 2.4 &#x2F;lib 目录 2.5 &#x2F;mnt 目录 2.6 &#x2F;proc 目录 2.7 &#x2F;usr 目录 2.8 &#x2F;var 目录 2.9 &#x2F;sys 目录   3 构建根文件系统 3.1 bus">
<meta property="og:type" content="article">
<meta property="og:title" content="Linux内核-rootfs构建移植">
<meta property="og:url" content="http://example.com/2024/07/20/Linux%E5%86%85%E6%A0%B8-rootfs%E6%9E%84%E5%BB%BA%E7%A7%BB%E6%A4%8D/index.html">
<meta property="og:site_name" content="Hexo">
<meta property="og:description" content="1 根文件系统的引入 2 根文件系统的组成 2.1 &#x2F;bin 目录 2.2 &#x2F;dev 目录 2.3 &#x2F;etc 目录 2.4 &#x2F;lib 目录 2.5 &#x2F;mnt 目录 2.6 &#x2F;proc 目录 2.7 &#x2F;usr 目录 2.8 &#x2F;var 目录 2.9 &#x2F;sys 目录   3 构建根文件系统 3.1 bus">
<meta property="og:locale" content="en_US">
<meta property="og:image" content="http://example.com/2024/07/20/Linux%E5%86%85%E6%A0%B8-rootfs%E6%9E%84%E5%BB%BA%E7%A7%BB%E6%A4%8D/1.png">
<meta property="og:image" content="http://example.com/2024/07/20/Linux%E5%86%85%E6%A0%B8-rootfs%E6%9E%84%E5%BB%BA%E7%A7%BB%E6%A4%8D/2.png">
<meta property="og:image" content="http://example.com/2024/07/20/Linux%E5%86%85%E6%A0%B8-rootfs%E6%9E%84%E5%BB%BA%E7%A7%BB%E6%A4%8D/3.png">
<meta property="og:image" content="http://example.com/2024/07/20/Linux%E5%86%85%E6%A0%B8-rootfs%E6%9E%84%E5%BB%BA%E7%A7%BB%E6%A4%8D/4.png">
<meta property="og:image" content="http://example.com/2024/07/20/Linux%E5%86%85%E6%A0%B8-rootfs%E6%9E%84%E5%BB%BA%E7%A7%BB%E6%A4%8D/5.png">
<meta property="og:image" content="http://example.com/2024/07/20/Linux%E5%86%85%E6%A0%B8-rootfs%E6%9E%84%E5%BB%BA%E7%A7%BB%E6%A4%8D/6.png">
<meta property="og:image" content="http://example.com/2024/07/20/Linux%E5%86%85%E6%A0%B8-rootfs%E6%9E%84%E5%BB%BA%E7%A7%BB%E6%A4%8D/7.png">
<meta property="og:image" content="http://example.com/2024/07/20/Linux%E5%86%85%E6%A0%B8-rootfs%E6%9E%84%E5%BB%BA%E7%A7%BB%E6%A4%8D/8.png">
<meta property="og:image" content="http://example.com/2024/07/20/Linux%E5%86%85%E6%A0%B8-rootfs%E6%9E%84%E5%BB%BA%E7%A7%BB%E6%A4%8D/9.png">
<meta property="og:image" content="http://example.com/2024/07/20/Linux%E5%86%85%E6%A0%B8-rootfs%E6%9E%84%E5%BB%BA%E7%A7%BB%E6%A4%8D/10.png">
<meta property="og:image" content="http://example.com/2024/07/20/Linux%E5%86%85%E6%A0%B8-rootfs%E6%9E%84%E5%BB%BA%E7%A7%BB%E6%A4%8D/11.png">
<meta property="og:image" content="http://example.com/2024/07/20/Linux%E5%86%85%E6%A0%B8-rootfs%E6%9E%84%E5%BB%BA%E7%A7%BB%E6%A4%8D/12.png">
<meta property="og:image" content="http://example.com/2024/07/20/Linux%E5%86%85%E6%A0%B8-rootfs%E6%9E%84%E5%BB%BA%E7%A7%BB%E6%A4%8D/13.png">
<meta property="og:image" content="http://example.com/2024/07/20/Linux%E5%86%85%E6%A0%B8-rootfs%E6%9E%84%E5%BB%BA%E7%A7%BB%E6%A4%8D/14.png">
<meta property="og:image" content="http://example.com/2024/07/20/Linux%E5%86%85%E6%A0%B8-rootfs%E6%9E%84%E5%BB%BA%E7%A7%BB%E6%A4%8D/15.png">
<meta property="og:image" content="http://example.com/2024/07/20/Linux%E5%86%85%E6%A0%B8-rootfs%E6%9E%84%E5%BB%BA%E7%A7%BB%E6%A4%8D/16.png">
<meta property="og:image" content="http://example.com/2024/07/20/Linux%E5%86%85%E6%A0%B8-rootfs%E6%9E%84%E5%BB%BA%E7%A7%BB%E6%A4%8D/17.png">
<meta property="og:image" content="http://example.com/2024/07/20/Linux%E5%86%85%E6%A0%B8-rootfs%E6%9E%84%E5%BB%BA%E7%A7%BB%E6%A4%8D/18.png">
<meta property="og:image" content="http://example.com/2024/07/20/Linux%E5%86%85%E6%A0%B8-rootfs%E6%9E%84%E5%BB%BA%E7%A7%BB%E6%A4%8D/19.png">
<meta property="og:image" content="http://example.com/2024/07/20/Linux%E5%86%85%E6%A0%B8-rootfs%E6%9E%84%E5%BB%BA%E7%A7%BB%E6%A4%8D/20.png">
<meta property="og:image" content="http://example.com/2024/07/20/Linux%E5%86%85%E6%A0%B8-rootfs%E6%9E%84%E5%BB%BA%E7%A7%BB%E6%A4%8D/21.png">
<meta property="og:image" content="http://example.com/2024/07/20/Linux%E5%86%85%E6%A0%B8-rootfs%E6%9E%84%E5%BB%BA%E7%A7%BB%E6%A4%8D/22.png">
<meta property="og:image" content="http://example.com/2024/07/20/Linux%E5%86%85%E6%A0%B8-rootfs%E6%9E%84%E5%BB%BA%E7%A7%BB%E6%A4%8D/23.png">
<meta property="og:image" content="http://example.com/2024/07/20/Linux%E5%86%85%E6%A0%B8-rootfs%E6%9E%84%E5%BB%BA%E7%A7%BB%E6%A4%8D/24.png">
<meta property="article:published_time" content="2024-07-20T09:47:28.000Z">
<meta property="article:modified_time" content="2024-09-16T11:12:40.835Z">
<meta property="article:author" content="John Doe">
<meta property="article:tag" content="linux内核">
<meta property="article:tag" content="linux系统构建">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="http://example.com/2024/07/20/Linux%E5%86%85%E6%A0%B8-rootfs%E6%9E%84%E5%BB%BA%E7%A7%BB%E6%A4%8D/1.png">
  
    <link rel="alternate" href="/atom.xml" title="Hexo" type="application/atom+xml">
  
  
    <link rel="shortcut icon" href="/favicon.png">
  
  
  
<link rel="stylesheet" href="/css/style.css">

  
    
<link rel="stylesheet" href="/fancybox/jquery.fancybox.min.css">

  
  
<meta name="generator" content="Hexo 7.1.1"></head>

<body>
  <div id="container">
    <div id="wrap">
      <header id="header">
  <div id="banner"></div>
  <div id="header-outer" class="outer">
    <div id="header-title" class="inner">
      <h1 id="logo-wrap">
        <a href="/" id="logo">Hexo</a>
      </h1>
      
    </div>
    <div id="header-inner" class="inner">
      <nav id="main-nav">
        <a id="main-nav-toggle" class="nav-icon"><span class="fa fa-bars"></span></a>
        
          <a class="main-nav-link" href="/">Home</a>
        
          <a class="main-nav-link" href="/archives">Archives</a>
        
      </nav>
      <nav id="sub-nav">
        
        
          <a class="nav-icon" href="/atom.xml" title="RSS Feed"><span class="fa fa-rss"></span></a>
        
        <a class="nav-icon nav-search-btn" title="Search"><span class="fa fa-search"></span></a>
      </nav>
      <div id="search-form-wrap">
        <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" class="search-form-input" placeholder="Search"><button type="submit" class="search-form-submit">&#xF002;</button><input type="hidden" name="sitesearch" value="http://example.com"></form>
      </div>
    </div>
  </div>
</header>

      <div class="outer">
        <section id="main"><article id="post-Linux内核-rootfs构建移植" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2024/07/20/Linux%E5%86%85%E6%A0%B8-rootfs%E6%9E%84%E5%BB%BA%E7%A7%BB%E6%A4%8D/" class="article-date">
  <time class="dt-published" datetime="2024-07-20T09:47:28.000Z" itemprop="datePublished">2024-07-20</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 class="p-name article-title" itemprop="headline name">
      Linux内核-rootfs构建移植
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <div class="toc">

<!-- toc -->

<ul>
<li><a href="#1-gen-wen-jian-xi-tong-de-yin-ru">1 根文件系统的引入</a></li>
<li><a href="#2-gen-wen-jian-xi-tong-de-zu-cheng">2 根文件系统的组成</a><ul>
<li><a href="#2-1-bin-mu-lu">2.1 &#x2F;bin 目录</a></li>
<li><a href="#2-2-dev-mu-lu">2.2 &#x2F;dev 目录</a></li>
<li><a href="#2-3-etc-mu-lu">2.3 &#x2F;etc 目录</a></li>
<li><a href="#2-4-lib-mu-lu">2.4 &#x2F;lib 目录</a></li>
<li><a href="#2-5-mnt-mu-lu">2.5 &#x2F;mnt 目录</a></li>
<li><a href="#2-6-proc-mu-lu">2.6 &#x2F;proc 目录</a></li>
<li><a href="#2-7-usr-mu-lu">2.7 &#x2F;usr 目录</a></li>
<li><a href="#2-8-var-mu-lu">2.8 &#x2F;var 目录</a></li>
<li><a href="#2-9-sys-mu-lu">2.9 &#x2F;sys 目录</a></li>
</ul>
</li>
<li><a href="#3-gou-jian-gen-wen-jian-xi-tong">3 构建根文件系统</a><ul>
<li><a href="#3-1-busybox">3.1 busybox</a><ul>
<li><a href="#3-1-1-pei-zhi-bian-yi-busybox">3.1.1 配置编译 BusyBox</a><ul>
<li><a href="#3-1-1-1-busybox-zhi-chi-zhong-wen-shi-bie">3.1.1.1 busybox支持中文识别</a></li>
<li><a href="#3-1-1-2-busybox-pei-zhi">3.1.1.2 busybox配置</a></li>
<li><a href="#3-1-1-3-bian-yi">3.1.1.3 编译</a></li>
</ul>
</li>
<li><a href="#3-1-2-gen-wen-jian-xi-tong-tian-jia-lib-ku">3.1.2 根文件系统添加 lib 库</a><ul>
<li><a href="#3-1-2-1-lib-ku-tian-jia">3.1.2.1 &#x2F;lib库添加</a></li>
<li><a href="#3-1-2-2-usr-lib-ku-tian-jia">3.1.2.2 &#x2F;usr&#x2F;lib库添加</a></li>
</ul>
</li>
<li><a href="#3-1-3-gen-wen-jian-xi-tong-tian-jia-qi-ta-mu-lu">3.1.3 根文件系统添加其他目录</a></li>
<li><a href="#3-1-4-gen-wen-jian-xi-tong-ce-shi">3.1.4 根文件系统测试</a></li>
<li><a href="#3-1-5-gen-wen-jian-xi-tong-tian-jia-etc-pei-zhi-jiao-ben">3.1.5 根文件系统添加 etc配置脚本</a><ul>
<li><a href="#3-1-5-1-chuang-jian-etc-init-d-rcs">3.1.5.1 创建&#x2F;etc&#x2F;init.d&#x2F;rcS</a></li>
<li><a href="#3-1-5-2-chuang-jian-etc-fstab">3.1.5.2 创建&#x2F;etc&#x2F;fstab</a></li>
<li><a href="#3-1-5-3-chuang-jian-etc-inittab-wen-jian">3.1.5.3 创建&#x2F;etc&#x2F;inittab文件</a></li>
<li><a href="#3-1-5-3-chuang-jian-etc-resolv-conf">3.1.5.3 创建&#x2F;etc&#x2F;resolv.conf</a></li>
<li><a href="#3-1-5-4-proc-cmdline">3.1.5.4 <code>/proc/cmdline</code></a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li><a href="#4-mkfs-gong-ju-zhi-zuo-ext4">4 mkfs工具制作ext4</a></li>
</ul>
<!-- tocstop -->

</div>

<h1><span id="1-gen-wen-jian-xi-tong-de-yin-ru">1 根文件系统的引入</span><a href="#1-gen-wen-jian-xi-tong-de-yin-ru" class="header-anchor">#</a></h1><p>我们知道文件系统类型有 <code>FATFS、FAT、EXT4、YAFFS 和 NTFS，squashfs</code>等。文件系统可以让我们利用文件IO的形式对文件目录进行访问，而不用去访问flash存储地址，在使用上更为方便轻松。<br>根文件系统rootfs, 首先是内核启动时所 mount(挂载)的第一个文件系统，系统引导启动程序会在根文件系统挂载之后从中把一些基本的初始化脚本和服务等加载到内存中去运行。<br>百度百科上说内核代码镜像文件保存在根文件系统中(对电脑端的Ubuntu来说确实是，放在<code>/boot/vmlinuz-5.4.0-152-generic</code>)。但是我们嵌入式 Linux 并没有将内核代码镜像保存在根文件系统中，而是保存到了其他地方，比如 NAND Flash 的指定存储地址、EMMC 专用分区中。<br>嵌入式根文件系统和 Linux 内核是分开的，单独的 Linux 内核是没法正常工作的，必须要搭配根文件系统。如果不提供根文件系统，Linux 内核在启动的时候就会提示内核崩溃(Kernel panic)：<br><img src="/2024/07/20/Linux%E5%86%85%E6%A0%B8-rootfs%E6%9E%84%E5%BB%BA%E7%A7%BB%E6%A4%8D/1.png" alt="image"></p>
<h1><span id="2-gen-wen-jian-xi-tong-de-zu-cheng">2 根文件系统的组成</span><a href="#2-gen-wen-jian-xi-tong-de-zu-cheng" class="header-anchor">#</a></h1><p><img src="/2024/07/20/Linux%E5%86%85%E6%A0%B8-rootfs%E6%9E%84%E5%BB%BA%E7%A7%BB%E6%A4%8D/2.png" alt="image"></p>
<h2><span id="2-1-x2f-bin-mu-lu">2.1 &#x2F;bin 目录</span><a href="#2-1-x2f-bin-mu-lu" class="header-anchor">#</a></h2><p>存放着系统需要的可执行文件，一般都是一些命令，比如<code>ls、cp、mv</code>等命令。<br><img src="/2024/07/20/Linux%E5%86%85%E6%A0%B8-rootfs%E6%9E%84%E5%BB%BA%E7%A7%BB%E6%A4%8D/3.png" alt="image"></p>
<h2><span id="2-2-x2f-dev-mu-lu">2.2 &#x2F;dev 目录</span><a href="#2-2-x2f-dev-mu-lu" class="header-anchor">#</a></h2><p>此目录下的文件都是设备节点文件：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">ls</span> -l /dev/</span><br><span class="line">crw-rw----    1 root     root       89,   9 Jan  1 08:00 /dev/i2c-9</span><br><span class="line">crw-rw----    1 root     root       10,  62 Jan  1 08:00 /dev/ion</span><br><span class="line">crw-rw----    1 root     root        1,  11 Jan  1 08:00 /dev/kmsg</span><br><span class="line">srw-rw-rw-    1 root     root             0 Jan  1 08:00 /dev/log</span><br><span class="line">crw-rw----    1 root     root       10, 237 Jan  1 08:00 /dev/loop-control</span><br><span class="line">brw-rw----    1 root     root        7,   0 Jan  1 08:00 /dev/loop0</span><br><span class="line">brw-rw----    1 root     root        7,   1 Jan  1 08:00 /dev/loop1</span><br><span class="line">brw-rw----    1 root     root      179,   0 Jan  1 08:00 /dev/mmcblk0</span><br><span class="line">brw-rw----    1 root     root      179,   8 Jan  1 08:00 /dev/mmcblk0boot0</span><br><span class="line">brw-rw----    1 root     root      179,  16 Jan  1 08:00 /dev/mmcblk0boot1</span><br><span class="line">brw-rw----    1 root     root      179,   1 Jan  1 08:00 /dev/mmcblk0p1</span><br><span class="line">brw-rw----    1 root     root      179,   2 Jan  1 08:00 /dev/mmcblk0p2</span><br><span class="line">brw-rw----    1 root     root      179,   3 Jan  1 08:00 /dev/mmcblk0p3</span><br><span class="line">brw-rw----    1 root     root      179,   4 Jan  1 08:00 /dev/mmcblk0p4</span><br></pre></td></tr></table></figure>

<h2><span id="2-3-x2f-etc-mu-lu">2.3 &#x2F;etc 目录</span><a href="#2-3-x2f-etc-mu-lu" class="header-anchor">#</a></h2><p>此目录下存放着各种配置文件。</p>
<h2><span id="2-4-x2f-lib-mu-lu">2.4 &#x2F;lib 目录</span><a href="#2-4-x2f-lib-mu-lu" class="header-anchor">#</a></h2><p>存放着 Linux 所必须的库文件。这些库文件是共享库，命令和用户编写的应用程序要使用这些库文件。</p>
<h2><span id="2-5-x2f-mnt-mu-lu">2.5 &#x2F;mnt 目录</span><a href="#2-5-x2f-mnt-mu-lu" class="header-anchor">#</a></h2><p>临时挂载目录，一般是空目录，可以在此目录下创建空的子目录，比如&#x2F;mnt&#x2F;sd、&#x2F;mnt&#x2F;usb，这样就可以将 SD 卡或者 U 盘挂载到&#x2F;mnt&#x2F;sd 或者&#x2F;mnt&#x2F;usb 目录中。</p>
<h2><span id="2-6-x2f-proc-mu-lu">2.6 &#x2F;proc 目录</span><a href="#2-6-x2f-proc-mu-lu" class="header-anchor">#</a></h2><p>proc虚拟文件系统，输出硬件驱动模块的相关信息，各种输出打印。（后续专门出一篇博文介绍）<br><img src="/2024/07/20/Linux%E5%86%85%E6%A0%B8-rootfs%E6%9E%84%E5%BB%BA%E7%A7%BB%E6%A4%8D/4.png" alt="image"></p>
<h2><span id="2-7-x2f-usr-mu-lu">2.7 &#x2F;usr 目录</span><a href="#2-7-x2f-usr-mu-lu" class="header-anchor">#</a></h2><p>这里的usr 不是 user 的缩写，而是 <code>Unix Software Resource </code>的缩写，也就是 Unix 操作系统软件资源目录。<br><img src="/2024/07/20/Linux%E5%86%85%E6%A0%B8-rootfs%E6%9E%84%E5%BB%BA%E7%A7%BB%E6%A4%8D/5.png" alt="image"></p>
<h2><span id="2-8-x2f-var-mu-lu">2.8 &#x2F;var 目录</span><a href="#2-8-x2f-var-mu-lu" class="header-anchor">#</a></h2><p>存放一些可以改变的数据。如&#x2F;var&#x2F;log。</p>
<pre><code>[root@robin]/var/log# ls
messages    messages.0  messages.1  messages.2  messages.3
</code></pre>
<h2><span id="2-9-x2f-sys-mu-lu">2.9 &#x2F;sys 目录</span><a href="#2-9-x2f-sys-mu-lu" class="header-anchor">#</a></h2><p>此目录作为 sysfs 文件系统的挂载点，sysfs 是一个类似于 proc 文件系统的特殊文件系统，sysfs 也是基于 ram 的文件系统，也就是说它也没有实际的存储设备。此目录是系统设备管理的重要目录，此目录通过一定的组织结构向用户提供详细的内核数据结构信息。</p>
<p>查看硬件模块IP的<code>base addr</code>：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">[root@robin]/sys/devices<span class="comment"># cd platform/</span></span><br><span class="line">[root@robin]/sys/devices/platform<span class="comment"># ls</span></span><br><span class="line">1040000.mon                 29230000.spi3</span><br><span class="line">1900000.rtos_cmdqu          29240000.can</span><br><span class="line">203c0000.bmtpu              29300000.cv-emmc</span><br><span class="line">20400000.pcie               29310000.cv-sd</span><br><span class="line">20bc0000.sata               29320000.cv-sd</span><br><span class="line">20bc0000.sata:sata-port@0   29330000.wifi-sd</span><br><span class="line">20bc0000.sata:sata-port@1   29340000.dma</span><br><span class="line">21020000.vc_drv             29350000.dma</span><br><span class="line">27000000.cv-wd              39000100.usb</span><br><span class="line">27010000.gpio               39000200.usb</span><br><span class="line">27011000.gpio               41d0c00.pdm</span><br><span class="line">27012000.gpio               5021000.gpio</span><br></pre></td></tr></table></figure>


<p>查看debug相关：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">[root@robin]/sys/kernel/debug<span class="comment"># ls</span></span><br><span class="line">27000000.cv-wd      dw_spi2             mtd</span><br><span class="line">asoc                dw_spi3             pinctrl</span><br><span class="line">bdi                 dynamic_debug       pwm</span><br><span class="line">block               extfrag             regmap</span><br><span class="line">bluetooth           fault_around_bytes  sched_debug</span><br><span class="line">clear_warn_once     gpio                sched_features</span><br><span class="line">clk                 hid                 sleep_time</span><br><span class="line">debug_enabled       ieee80211           split_huge_pages</span><br></pre></td></tr></table></figure>
<p>重要的有：</p>
<figure class="highlight makefile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">/sys/kernel/debug/debug_enabled</span><br><span class="line">/sys/kernel/debug/dynamic_debug/control</span><br><span class="line">/sys/kernel/debug/clk/clk_summary</span><br></pre></td></tr></table></figure>

<p>查看和设置驱动模块module param变量：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cd</span> /sys/module/soph_stitch/parameters</span><br><span class="line">[root@cvitek]/sys/module/soph_stitch/parameters<span class="comment"># cat stitch_log_lv</span></span><br><span class="line">2</span><br><span class="line">[root@cvitek]/sys/module/soph_stitch/parameters<span class="comment"># echo 2 &gt; stitch_log_lv</span></span><br><span class="line">[root@cvitek]/sys/module/soph_stitch/parameters<span class="comment"># cat stitch_log_lv</span></span><br><span class="line">2</span><br></pre></td></tr></table></figure>

<h1><span id="3-gou-jian-gen-wen-jian-xi-tong">3 构建根文件系统</span><a href="#3-gou-jian-gen-wen-jian-xi-tong" class="header-anchor">#</a></h1><h2><span id="3-1-busybox">3.1 busybox</span><a href="#3-1-busybox" class="header-anchor">#</a></h2><p>BusyBox 是一个集成了大量的 Linux 命令和工具的软件，像<code>ls、mv、ifconfig</code>等命令 BusyBox 都会提供。<br>一般下载 BusyBox 的源码，然后配置 BusyBox，选择自己想要的功能，最后编译即可。<br>BusyBox 可以在其官网下载到，官网地址为：<br><a target="_blank" rel="noopener" href="https://busybox.net/downloads/">https://busybox.net/downloads/</a></p>
<h3><span id="3-1-1-pei-zhi-bian-yi-busybox">3.1.1 配置编译 BusyBox</span><a href="#3-1-1-pei-zhi-bian-yi-busybox" class="header-anchor">#</a></h3><p>这里我下载的<code>busybox-1.29.0.tar.bz2</code>， 将其进行解压：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">mkdir</span> rootfs；<span class="built_in">cd</span> rootfs; tar xfj busybox-1.29.0.tar.bz2</span><br></pre></td></tr></table></figure>
<p><img src="/2024/07/20/Linux%E5%86%85%E6%A0%B8-rootfs%E6%9E%84%E5%BB%BA%E7%A7%BB%E6%A4%8D/6.png" alt="image"><br>修改Makefile添加<code>toolchain</code>:</p>
<figure class="highlight makefile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">164 CROSS_COMPILE ?= /usr/local/arm/gcc-linaro-4.9.4-2017.01-x86_64_arm-linux-gnueabihf/bin/arm-linux-gnueabihf-</span><br><span class="line">......</span><br><span class="line">190 ARCH ?= arm</span><br></pre></td></tr></table></figure>

<h4><span id="3-1-1-1-busybox-zhi-chi-zhong-wen-shi-bie">3.1.1.1 busybox支持中文识别</span><a href="#3-1-1-1-busybox-zhi-chi-zhong-wen-shi-bie" class="header-anchor">#</a></h4><p>我们知道中文的编码如果采用<code>utf8</code>，那么<code>ascii</code>值肯定是大于<code>0x7f</code>的。因此需要修改busybox源码，让其能识别超过<code>ascii</code>的编码范围<code>0x7f</code>。</p>
<p><strong>utf8 中文编码</strong>：<br>UTF-8是一种广泛使用的<code>Unicode</code>编码方式，它可以用来表示各种语言和符号。对于中文字来说，UTF-8采用了一种特殊的编码方式，即中文字符主要使用三个字节（21比特）来表示。具体来说，当一个汉字的Unicode码位于0x80到0x7FF之间的时，UTF-8会用三个字节来编码这个汉字。例如，汉字“爸”在UTF-8中的编码过程是这样的：</p>
<p>首先，将汉字<code>“爸”</code>的<code>Unicode</code>码<code>（0x5BAD）</code>转换为二进制数<code>（0111 0010 0011 1000）</code>。<br>然后，按照UTF-8的三字节模式进行编码，即每个字节的最高位都设置为1，剩下的7位用于表示该字节所对应的Unicode值。在这个例子中，第一个字节的高位为1，表示这是一个16位的字节；接下来的三位为1011，对应于Unicode码中的第11位，即十进制的5；最后一位为0，代表这是一个字节的最低位。<br>最后，将这三个字节的二进制数转换为十六进制数<code>（0xE788B8）</code>，这就是汉字<code>“爸”</code>在UTF-8中的编码形式。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vi libbb/unicode.c</span><br></pre></td></tr></table></figure>
<p>打开函数<code>unicode_conv_to_printable2</code>,修改如下：<br><img src="/2024/07/20/Linux%E5%86%85%E6%A0%B8-rootfs%E6%9E%84%E5%BB%BA%E7%A7%BB%E6%A4%8D/7.png" alt="image"></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vi libbb/printable_string.c</span><br></pre></td></tr></table></figure>
<p><img src="/2024/07/20/Linux%E5%86%85%E6%A0%B8-rootfs%E6%9E%84%E5%BB%BA%E7%A7%BB%E6%A4%8D/8.png" alt="image"></p>
<h4><span id="3-1-1-2-busybox-pei-zhi">3.1.1.2 busybox配置</span><a href="#3-1-1-2-busybox-pei-zhi" class="header-anchor">#</a></h4><p>编译busybox前要先对 busybox 进行默认的配置，有以下几种配置选项：</p>
<figure class="highlight makefile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">①、defconfig，缺省配置，也就是默认配置选项。</span><br><span class="line">②、allyesconfig，全选配置，也就是选中 busybox 的所有功能</span><br><span class="line">③、allnoconfig，最小配置。</span><br><span class="line"></span><br><span class="line">make defconfig</span><br><span class="line">make menuconfig</span><br></pre></td></tr></table></figure>

<p><img src="/2024/07/20/Linux%E5%86%85%E6%A0%B8-rootfs%E6%9E%84%E5%BB%BA%E7%A7%BB%E6%A4%8D/9.png" alt="image"></p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">-&gt; Settings </span><br><span class="line">	-&gt; Build <span class="type">static</span> <span class="title function_">binary</span> <span class="params">(no shared libs)</span></span><br></pre></td></tr></table></figure>
<p>这项请不要勾选，静态编译 busybox会DNS解析有问题。</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">-&gt; Settings</span><br><span class="line">	-&gt; vi-style line editing commands</span><br></pre></td></tr></table></figure>
<p>建议勾选这项。</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">-&gt; Linux Module Utilities</span><br><span class="line">	-&gt; Simplified modutils</span><br></pre></td></tr></table></figure>
<p>默认会选中“Simplified modutils”，这里我们要取消勾选。</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">-&gt; Linux System Utilities</span><br><span class="line">	-&gt; mdev (<span class="number">16</span> kb) <span class="comment">//确保下面的全部选中，默认都是选中的</span></span><br></pre></td></tr></table></figure>
<p><img src="/2024/07/20/Linux%E5%86%85%E6%A0%B8-rootfs%E6%9E%84%E5%BB%BA%E7%A7%BB%E6%A4%8D/10.png" alt="image"></p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">-&gt; Settings</span><br><span class="line">	-&gt; Support Unicode <span class="comment">//选中</span></span><br><span class="line">		-&gt; Check $LC_ALL, $LC_CTYPE and $LANG environment variables <span class="comment">//选中</span></span><br></pre></td></tr></table></figure>
<p><img src="/2024/07/20/Linux%E5%86%85%E6%A0%B8-rootfs%E6%9E%84%E5%BB%BA%E7%A7%BB%E6%A4%8D/11.png" alt="image"></p>
<h4><span id="3-1-1-3-bian-yi">3.1.1.3 编译</span><a href="#3-1-1-3-bian-yi" class="header-anchor">#</a></h4><figure class="highlight makefile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">make ARCH=arm CROSS_COMPILE=arm-linux-gnueabihf-</span><br><span class="line">make install CONFIG_PREFIX=/media/cvitek/robin.lee/rootfs ARCH=arm CROSS_COMPILE=arm-linux-gnueabihf-</span><br></pre></td></tr></table></figure>
<p><img src="/2024/07/20/Linux%E5%86%85%E6%A0%B8-rootfs%E6%9E%84%E5%BB%BA%E7%A7%BB%E6%A4%8D/12.png" alt="image"><br><img src="/2024/07/20/Linux%E5%86%85%E6%A0%B8-rootfs%E6%9E%84%E5%BB%BA%E7%A7%BB%E6%A4%8D/13.png" alt="image"></p>
<p>busybox 的所有工具和文件就会被安装到 rootfs 目录中，rootfs 目录内容如下：<br><img src="/2024/07/20/Linux%E5%86%85%E6%A0%B8-rootfs%E6%9E%84%E5%BB%BA%E7%A7%BB%E6%A4%8D/14.png" alt="image"><br>命令和工具都再对应&#x2F;bin &#x2F;usr&#x2F;bin对应的目录：<br><img src="/2024/07/20/Linux%E5%86%85%E6%A0%B8-rootfs%E6%9E%84%E5%BB%BA%E7%A7%BB%E6%A4%8D/15.png" alt="image"></p>
<p><a target="_blank" rel="noopener" href="https://www.cnblogs.com/fuzidage/p/17995165" title="3.linux内核启动流程">3.linux内核启动流程</a></p>
<p><a target="_blank" rel="noopener" href="https://fuzidage.github.io/2024/07/20/Linux%E5%86%85%E6%A0%B8%E5%90%AF%E5%8A%A8%E6%B5%81%E7%A8%8B/">Linux内核启动流程 | Hexo (fuzidage.github.io)</a></p>
<p>说过 Linux 内核 init 进程最后会查找用户空间的 init 程序，找到以后就会运行这个用户空间的 init 程序，从而切换到用户态。如果 <code>bootargs</code> 设置 <code>init=/linuxrc</code>，那么 linuxrc 就是可以作为用户空间的 init 程序，所以用户态空间的 init 程序是 busybox 来生成的。</p>
<p>我们的根文件系统此时就制作好了，但此时还不能使用，还需要一些其他的文件，我们继续来完善 rootfs。</p>
<h3><span id="3-1-2-gen-wen-jian-xi-tong-tian-jia-lib-ku">3.1.2 根文件系统添加 lib 库</span><a href="#3-1-2-gen-wen-jian-xi-tong-tian-jia-lib-ku" class="header-anchor">#</a></h3><h4><span id="3-1-2-1-x2f-lib-ku-tian-jia">3.1.2.1 &#x2F;lib库添加</span><a href="#3-1-2-1-x2f-lib-ku-tian-jia" class="header-anchor">#</a></h4><p>Linux 中的应用程序一般都是需要动态库的，当然你也可以编译成静态的，但是静态的可执行文件会很大。如果编译为动态的话就需要动态库，所以我们需要向根文件系统中添加动态库。lib 库文件从交叉编译器中获取：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">mkdir</span> lib</span><br><span class="line"><span class="built_in">cd</span> gcc-linaro-4.9.4-2017.01-x86_64_arm-linux-gnueabihf/arm-linux-gnueabihf/libc/lib</span><br></pre></td></tr></table></figure>
<p>libc库如下：将其拷贝进rootfs。<br><img src="/2024/07/20/Linux%E5%86%85%E6%A0%B8-rootfs%E6%9E%84%E5%BB%BA%E7%A7%BB%E6%A4%8D/16.png" alt="image"></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cp</span> *so* *.a /media/cvitek/robin.lee/rootfs/lib -d <span class="comment">#-d表示将软链接也一同拷贝</span></span><br></pre></td></tr></table></figure>

<p>进入工具链的lib库：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cd</span> gcc-linaro-4.9.4-2017.01-x86_64_arm-linux-gnueabihf/arm-linux-gnueabihf/libc/lib</span><br><span class="line"><span class="built_in">cp</span> *so* *.a /media/cvitek/robin.lee/rootfs/lib -d <span class="comment">#-d表示将软链接也一同拷贝</span></span><br></pre></td></tr></table></figure>
<p>最终根文件系统的&#x2F;lib内容如下：<br><img src="/2024/07/20/Linux%E5%86%85%E6%A0%B8-rootfs%E6%9E%84%E5%BB%BA%E7%A7%BB%E6%A4%8D/17.png" alt="image"></p>
<h4><span id="3-1-2-2-x2f-usr-x2f-lib-ku-tian-jia">3.1.2.2 &#x2F;usr&#x2F;lib库添加</span><a href="#3-1-2-2-x2f-usr-x2f-lib-ku-tian-jia" class="header-anchor">#</a></h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">mkdir</span> /usr/lib</span><br><span class="line"><span class="built_in">cd</span> gcc-linaro-4.9.4-2017.01-x86_64_arm-linux-gnueabihf/arm-linux-gnueabihf/libc/usr/lib</span><br></pre></td></tr></table></figure>
<p>libc&#x2F;usr&#x2F;lib库如下：将其拷贝进rootfs。<br><img src="/2024/07/20/Linux%E5%86%85%E6%A0%B8-rootfs%E6%9E%84%E5%BB%BA%E7%A7%BB%E6%A4%8D/18.png" alt="image"></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cp</span> *so* *.a /media/cvitek/robin.lee/rootfs/usr/lib -d <span class="comment">#-d表示将软链接也一同拷贝</span></span><br></pre></td></tr></table></figure>
<p>至此，根文件系统的库文件就全部添加好了。来看下库占用存储空间多少：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">robin.lee@WORKSTATION5:/media/cvitek/robin.lee/rootfs$ <span class="built_in">du</span> ./lib ./usr/lib/ -sh</span><br><span class="line">57M     ./lib</span><br><span class="line">67M     ./usr/lib/</span><br></pre></td></tr></table></figure>

<h3><span id="3-1-3-gen-wen-jian-xi-tong-tian-jia-qi-ta-mu-lu">3.1.3 根文件系统添加其他目录</span><a href="#3-1-3-gen-wen-jian-xi-tong-tian-jia-qi-ta-mu-lu" class="header-anchor">#</a></h3><p>dev、proc、mnt、sys、tmp 和 root这些目录需要在rootfs进行创建。<br><img src="/2024/07/20/Linux%E5%86%85%E6%A0%B8-rootfs%E6%9E%84%E5%BB%BA%E7%A7%BB%E6%A4%8D/19.png" alt="image"></p>
<h3><span id="3-1-4-gen-wen-jian-xi-tong-ce-shi">3.1.4 根文件系统测试</span><a href="#3-1-4-gen-wen-jian-xi-tong-ce-shi" class="header-anchor">#</a></h3><p>初步测试我们的rootfs功能，我们最好是利用nfs挂载根文件系统，方便修改。之前<code>bootargs</code>都是设置：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">setenv bootargs <span class="string">&#x27;console=ttymxc0,115200 root=/dev/mmcblk1p2 rootwait rw&#x27;</span></span><br></pre></td></tr></table></figure>
<p>从emmc分区2启动，分区2存放了根文件系统。现在bootargs改成nfs挂载rootfs要如何设置呢？<br>文档为 <code>Documentation/filesystems/nfs/nfsroot.txt</code>，格式如下：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">root=/dev/nfs nfsroot=[&lt;server-ip&gt;:]&lt;root-dir&gt;[,&lt;nfs-options&gt;] ip=&lt;client-ip&gt;:&lt;server-ip&gt;:&lt;gw-ip&gt;:&lt;netmask&gt;:&lt;hostname&gt;:&lt;device&gt;:&lt;autoconf&gt;:&lt;dns0-ip&gt;:&lt;dns1-ip&gt;</span><br><span class="line"></span><br><span class="line">&lt;server-ip&gt;：服务器 IP 地址，比如我的 Ubuntu 主机 IP 地址为 192.168.1.250。</span><br><span class="line">&lt;root-dir&gt;：根文件系统的存放路径，要保证放在nfs共享目录下。比如我的就是/media/cvitek/robin.lee/rootfs</span><br><span class="line">&lt;nfs-options&gt;：NFS 的其他可选选项，一般不设置。</span><br><span class="line">&lt;client-ip&gt;：客户端 IP 地址，也就是我们开发板的 IP 地址</span><br><span class="line">&lt;server-ip&gt;：服务器 IP 地址，前面已经说了。</span><br><span class="line">&lt;gw-ip&gt;：网关地址，我的就是 192.168.1.1。</span><br><span class="line">&lt;netmask&gt;：子网掩码，我的就是 255.255.255.0。</span><br><span class="line">&lt;hostname&gt;：客户机的名字，一般不设置，此值可以空着。</span><br><span class="line">&lt;device&gt;：设备名，也就是网卡名，一般是 eth0，eth1….，正点原子的 I.MX6U-ALPHA 开发板的 ENET2 为 eth0，ENET1 为 eth1。</span><br><span class="line">&lt;autoconf&gt;：自动配置，一般不使用，所以设置为 off。</span><br><span class="line">&lt;dns0-ip&gt;：DNS0 服务器 IP 地址，不使用。</span><br><span class="line">&lt;dns1-ip&gt;：DNS1 服务器 IP 地址，不使用。</span><br></pre></td></tr></table></figure>

<p>最终我们设置 bootargs 环境变量的 root 值如下：<br><code>root=/dev/nfs nfsroot=192.168.1.250:/media/cvitek/robin.lee/rootfs,proto=tcp rw ip=192.168.1.251:192.168.1.250:192.168.1.1:255.255.255.0::eth0:off</code></p>
<p><code>“proto=tcp”</code>表示使用 TCP 协议，<code>“rw”</code>表示 nfs 挂载的根文件系统为可读可写。<br>修改保存环境变量：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">setenv bootargs <span class="string">&#x27;console=ttymxc0,115200 root=/dev/nfs nfsroot=192.168.1.250:/media/cvitek/robin.lee/rootfs,proto=tcp rw ip=192.168.1.251:192.168.1.250:192.168.1.1:255.255.255.0::eth0:off&#x27;</span> <span class="comment">#设置 bootargs</span></span><br><span class="line">saveenv <span class="comment">#保存环境变量</span></span><br></pre></td></tr></table></figure>

<p>设置好以后使用<code>“boot”</code>命令启动 Linux 内核，输出打印如下：<br><img src="/2024/07/20/Linux%E5%86%85%E6%A0%B8-rootfs%E6%9E%84%E5%BB%BA%E7%A7%BB%E6%A4%8D/20.png" alt="image"><br>可以看到成功挂载rootfs，并且进入Linux控制台。</p>
<h3><span id="3-1-5-gen-wen-jian-xi-tong-tian-jia-etc-pei-zhi-jiao-ben">3.1.5 根文件系统添加 etc配置脚本</span><a href="#3-1-5-gen-wen-jian-xi-tong-tian-jia-etc-pei-zhi-jiao-ben" class="header-anchor">#</a></h3><h4><span id="3-1-5-1-chuang-jian-x2f-etc-x2f-init-d-x2f-rcs">3.1.5.1 创建&#x2F;etc&#x2F;init.d&#x2F;rcS</span><a href="#3-1-5-1-chuang-jian-x2f-etc-x2f-init-d-x2f-rcs" class="header-anchor">#</a></h4><p>前面打印有一行报错，进入根文件系统的时候会有下面这一行错误提示：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">can<span class="string">&#x27;t run &#x27;</span>/etc/init.d/rcS<span class="string">&#x27;: No such file or directory</span></span><br></pre></td></tr></table></figure>
<p>rcS 是个 shell 脚本，Linux 内核启动以后需要启动一些服务，而 rcS 就是规定启动哪些文件的脚本文件。在 rootfs 中创建<code>/etc/init.d/rcS </code>文件，然后在 rcS 中输入如下所示内容：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#!/bin/sh</span></span><br><span class="line"></span><br><span class="line">PATH=/sbin:/bin:/usr/sbin:/usr/bin:<span class="variable">$PATH</span></span><br><span class="line">LD_LIBRARY_PATH=<span class="variable">$LD_LIBRARY_PATH</span>:/lib:/usr/lib</span><br><span class="line"><span class="built_in">export</span> PATH LD_LIBRARY_PATH</span><br><span class="line"></span><br><span class="line">mount -a</span><br><span class="line"><span class="built_in">mkdir</span> /dev/pts</span><br><span class="line">mount -t devpts devpts /dev/pts</span><br><span class="line"></span><br><span class="line"><span class="built_in">echo</span> /sbin/mdev &gt; /proc/sys/kernel/hotplug</span><br><span class="line">mdev -s</span><br></pre></td></tr></table></figure>
<p><code>PATH</code> 环境变量保存着可执行文件可能存在的目录;<br><code>LD_LIBRARY_PATH</code> 环境变量保存着库文件所在的目录;<br>mount 命令来挂载所有的文件系统，这些文件系统由文件<code>/etc/fstab</code> 来指定;<br>创建目录<code>/dev/pts</code>，然后将 <code>devpts</code> 挂载到<code>/dev/pts </code>目录中。<br>使用 mdev 来管理热插拔设备，通过这两行，Linux 内核就可以在&#x2F;dev 目录下自动创建设备节点。</p>
<p>我们是简单构造了一个最简单的rcS, 大家如果去看 Ubuntu 或者其他大型 Linux操作系统中的 rcS 文件，就会发现其非常复杂。而且这么复杂的 rcS 文件也是借助其他工具创建的，比如 buildroot 等。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">chmod</span> 777 rcS</span><br></pre></td></tr></table></figure>
<p>重新启动 Linux 内核，启动以后如下图：<br><img src="/2024/07/20/Linux%E5%86%85%E6%A0%B8-rootfs%E6%9E%84%E5%BB%BA%E7%A7%BB%E6%A4%8D/21.png" alt="image"></p>
<h4><span id="3-1-5-2-chuang-jian-x2f-etc-x2f-fstab">3.1.5.2 创建&#x2F;etc&#x2F;fstab</span><a href="#3-1-5-2-chuang-jian-x2f-etc-x2f-fstab" class="header-anchor">#</a></h4><p>fstab 在 Linux 开机以后自动配置哪些需要自动挂载的分区，格式如下：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">&lt;file system&gt; &lt;mount point&gt; &lt;<span class="built_in">type</span>&gt; &lt;options&gt; &lt;dump&gt; &lt;pass&gt;</span><br><span class="line"></span><br><span class="line">&lt;file system&gt;：要挂载的特殊的设备，也可以是块设备，比如/dev/sda 等等</span><br><span class="line">&lt;mount point&gt;：挂载点。</span><br><span class="line">&lt;<span class="built_in">type</span>&gt;：文件系统类型，比如 ext2、ext3、proc、romfs、tmpfs 等等。</span><br><span class="line">&lt;options&gt;：挂载选项，一般使用 defaults，defaults 包含了 rw、suid、 dev、 <span class="built_in">exec</span>、 auto、 nouser 和 async。</span><br><span class="line">&lt;dump&gt;：为 1 的话表示允许备份，为 0 不备份，一般不备份，因此设置为 0。</span><br><span class="line">&lt;pass&gt;：磁盘检查设置，为 0 表示不检查。根目录‘/’设置为 1，其他的都不能设置为 1，因此这里一般设置为 0</span><br></pre></td></tr></table></figure>
<p>fstab内容设置如下：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#&lt;file system&gt;   &lt;mount point&gt;     &lt;type&gt;     &lt;options&gt;   &lt;dump&gt;    &lt;pass&gt;</span></span><br><span class="line">proc             /proc             proc       defaults    0         0</span><br><span class="line">tmpfs            /tmp              tmpfs      defaults    0         0</span><br><span class="line">sysfs            /sys              sysfs      defaults    0         0</span><br></pre></td></tr></table></figure>

<p><code>fstab </code>文件创建完成以后重新启动 Linux打印如下：<br><img src="/2024/07/20/Linux%E5%86%85%E6%A0%B8-rootfs%E6%9E%84%E5%BB%BA%E7%A7%BB%E6%A4%8D/22.png" alt="image"></p>
<h4><span id="3-1-5-3-chuang-jian-x2f-etc-x2f-inittab-wen-jian">3.1.5.3 创建&#x2F;etc&#x2F;inittab文件</span><a href="#3-1-5-3-chuang-jian-x2f-etc-x2f-inittab-wen-jian" class="header-anchor">#</a></h4><p>inittab 的详细内容可以参考 busybox 下的文件 <code>examples/inittab</code>。init 程序会读取<code>/etc/inittab</code>这个文件，inittab 由若干条指令组成。每条指令的结构都是一样的，由以“:”分隔的 4 个段组成，格式如下：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">&lt;<span class="built_in">id</span>&gt;:&lt;runlevels&gt;:&lt;action&gt;:&lt;process&gt;</span><br><span class="line">&lt;<span class="built_in">id</span>&gt;：每个指令的标识符，不能重复。但是对于 busybox 的 init 来说，&lt;<span class="built_in">id</span>&gt;有着特殊意义。对于 busybox 而言&lt;<span class="built_in">id</span>&gt;用来指定启动进程的控制 <span class="built_in">tty</span>，一般我们将串口或者 LCD 屏幕设置为控制 <span class="built_in">tty</span>。</span><br><span class="line">&lt;runlevels&gt;：对 busybox 来说此项完全没用，所以空着。</span><br><span class="line">&lt;action&gt;：动作，用于指定&lt;process&gt;可能用到的动作:</span><br><span class="line">	busybox 支持的动作如下：</span><br><span class="line">	sysinit: 在系统初始化的时候 process 才会执行一次。</span><br><span class="line">	respawn: 当 process 终止以后马上启动一个新的。</span><br><span class="line">	askfirst:和 respawn 类似，在运行 process 之前在控制台上显示“Please press Enter to activate this console.”。只要用户按下“Enter”键以后才会执行 process。</span><br><span class="line">	<span class="built_in">wait</span>: 告诉 init，要等待相应的进程执行完以后才能继续执行。</span><br><span class="line">	once: 仅执行一次，而且不会等待 process 执行完成。</span><br><span class="line">	restart: 当 init 重启的时候才会执行 procee。</span><br><span class="line">	ctrlaltdel: 当按下 ctrl+alt+del 组合键才会执行 process。</span><br><span class="line">	shutdown: 关机的时候执行 process。</span><br><span class="line">&lt;process&gt;：具体的动作，比如程序、脚本或命令等</span><br></pre></td></tr></table></figure>

<p>我们的&#x2F;etc&#x2F;inittab内容设置如下：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#etc/inittab</span></span><br><span class="line">::sysinit:/etc/init.d/rcS</span><br><span class="line">console::askfirst:-/bin/sh</span><br><span class="line">::restart:/sbin/init</span><br><span class="line">::ctrlaltdel:/sbin/reboot</span><br><span class="line">::shutdown:/bin/umount -a -r</span><br><span class="line">::shutdown:/sbin/swapoff -a</span><br></pre></td></tr></table></figure>

<p>第 2 行，系统启动以后运行<code>/etc/init.d/rcS </code>这个脚本文件。<br>第 3 行，将 console 作为控制台终端，也就是 ttymxc0。<br>第 4 行，重启的话运行&#x2F;sbin&#x2F;init。<br>第 5 行，按下 ctrl+alt+del 组合键的话就运行<code>/sbin/reboot</code>，看来 ctrl+alt+del 组合键用于重启系统。<br>第 6 行，关机的时候执行<code>/bin/umount</code>，也就是卸载各个文件系统。<br>第 7 行，关机的时候执行<code>/sbin/swapoff</code>，也就是关闭交换分区。</p>
<p><img src="/2024/07/20/Linux%E5%86%85%E6%A0%B8-rootfs%E6%9E%84%E5%BB%BA%E7%A7%BB%E6%A4%8D/23.png" alt="image"></p>
<h4><span id="3-1-5-3-chuang-jian-x2f-etc-x2f-resolv-conf">3.1.5.3 创建&#x2F;etc&#x2F;resolv.conf</span><a href="#3-1-5-3-chuang-jian-x2f-etc-x2f-resolv-conf" class="header-anchor">#</a></h4><p><code>/etc/resolv.conf</code>是DNS客户机配置文件，用于设置DNS服务器的IP地址及DNS域名，还包含了主机的域名搜索顺序。该文件是由域名解析器（resolver，一个根据主机名解析IP地址的库）使用的配置文件。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">nameserver： 配置DNS服务器地址（顺序来查询，且只有当第一个nameserver没有反应时才查询下面的nameserver）</span><br><span class="line">domain： 声明主机的域名，当查询不完全的域名时主机名将被使用(相当于search的默认值)</span><br><span class="line">search： 它的多个参数指明域名查询顺序。当查询不完全的域名时会使用到（domain和search不能共存）</span><br></pre></td></tr></table></figure>

<p>默认<code>/etc/resolv.conf</code>配置：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Generated by NetworkManager</span></span><br><span class="line">nameserver 192.168.248.2</span><br></pre></td></tr></table></figure>

<p>一般将<strong>nameserver</strong>设置成网关地址，再加入<code>8.8.8.8</code>和<code>114.114.114.114</code></p>
<p><code>ping blog.csdn.com</code>：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[root@node2 ~]<span class="comment"># ping blog.csdn.com</span></span><br><span class="line">PING blog.csdn.com.com (45.11.57.36) 56(84) bytes of data.</span><br><span class="line">64 bytes from comcomproxy1.com.com (45.11.57.36): icmp_seq=1 ttl=44 time=291 ms</span><br><span class="line">64 bytes from comcomproxy1.com.com (45.11.57.36): icmp_seq=2 ttl=44 time=270 ms</span><br></pre></td></tr></table></figure>

<p><code>ping blog</code>，发现不通，需要设置<code>domain域</code>：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[root@node2 ~]<span class="comment"># ping blog</span></span><br><span class="line">ping: blog: 未知的名称或服务</span><br></pre></td></tr></table></figure>
<p>调整<code>/etc/resolv.conf</code>配置文件,添加<strong>domain</strong></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[root@node2 ~]<span class="comment"># vi /etc/resolv.conf</span></span><br><span class="line"><span class="comment"># Generated by NetworkManager</span></span><br><span class="line">nameserver 192.168.248.2</span><br><span class="line">domain csdn.net</span><br></pre></td></tr></table></figure>

<p>再次<code>ping blog</code>, ping不完整域名会自动补全</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[root@node2 ~]<span class="comment"># ping blog</span></span><br><span class="line">PING blog.csdn.net (182.92.187.217) 56(84) bytes of data.</span><br><span class="line">64 bytes from 182.92.187.217 (182.92.187.217): icmp_seq=1 ttl=89 time=20.4 ms</span><br></pre></td></tr></table></figure>

<p>调整<code>/etc/resolv.conf</code>配置文件,添加<strong>search</strong></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[root@node2 ~]<span class="comment"># vi /etc/resolv.conf</span></span><br><span class="line"><span class="comment"># Generated by NetworkManager</span></span><br><span class="line">nameserver 192.168.248.2</span><br><span class="line">search abc.com csdn.net</span><br></pre></td></tr></table></figure>

<h4><span id="3-1-5-4-proc-cmdline">3.1.5.4 <code>/proc/cmdline</code></span><a href="#3-1-5-4-proc-cmdline" class="header-anchor">#</a></h4><p><code>cat /proc/cmdline</code> 可以看到内核启动时U-boot传入参数:<br><img src="/2024/07/20/Linux%E5%86%85%E6%A0%B8-rootfs%E6%9E%84%E5%BB%BA%E7%A7%BB%E6%A4%8D/24.png" alt="image"></p>
<h1><span id="4-mkfs-gong-ju-zhi-zuo-ext4">4 mkfs工具制作ext4</span><a href="#4-mkfs-gong-ju-zhi-zuo-ext4" class="header-anchor">#</a></h1><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">robin.lee@WORKSTATION5:/media/cvitek/robin.lee/zip/a2_dev/install/soc_cv186ah_wevb_emmc$ <span class="built_in">dd</span> <span class="keyword">if</span>=/dev/zero of=rootfs.ext4 bs=1M count=1024</span><br><span class="line">1024+0 records <span class="keyword">in</span></span><br><span class="line">1024+0 records out</span><br><span class="line">1073741824 bytes (1.1 GB, 1.0 GiB) copied, 0.391472 s, 2.7 GB/s</span><br><span class="line">robin.lee@WORKSTATION5:/media/cvitek/robin.lee/zip/a2_dev/install/soc_cv186ah_wevb_emmc$ mkfs.ext4 -L rootfs rootfs.ext4</span><br><span class="line">mke2fs 1.45.5 (07-Jan-2020)</span><br><span class="line">Discarding device blocks: <span class="keyword">done</span></span><br><span class="line">Creating filesystem with 262144 4k blocks and 65536 inodes</span><br><span class="line">Filesystem UUID: a14867d2-d5db-4595-aa4b-fff7ef483bdd</span><br><span class="line">Superblock backups stored on blocks:</span><br><span class="line">        32768, 98304, 163840, 229376</span><br><span class="line"></span><br><span class="line">Allocating group tables: <span class="keyword">done</span></span><br><span class="line">Writing inode tables: <span class="keyword">done</span></span><br><span class="line">Creating journal (8192 blocks): <span class="keyword">done</span></span><br><span class="line">Writing superblocks and filesystem accounting information: <span class="keyword">done</span></span><br></pre></td></tr></table></figure>
      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/2024/07/20/Linux%E5%86%85%E6%A0%B8-rootfs%E6%9E%84%E5%BB%BA%E7%A7%BB%E6%A4%8D/" data-id="cm0xxogdr0006qsuf9kzn4vjn" data-title="Linux内核-rootfs构建移植" class="article-share-link"><span class="fa fa-share">Share</span></a>
      
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/linux%E5%86%85%E6%A0%B8/" rel="tag">linux内核</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/linux%E7%B3%BB%E7%BB%9F%E6%9E%84%E5%BB%BA/" rel="tag">linux系统构建</a></li></ul>

    </footer>
  </div>
  
    
<nav id="article-nav">
  
    <a href="/2024/07/20/Linux%E5%86%85%E6%A0%B8-%E5%B9%B6%E5%8F%91%E4%B8%8E%E5%90%8C%E6%AD%A5/" id="article-nav-newer" class="article-nav-link-wrap">
      <strong class="article-nav-caption">Newer</strong>
      <div class="article-nav-title">
        
          Linux内核-并发与同步
        
      </div>
    </a>
  
  
    <a href="/2024/07/20/Linux%E5%86%85%E6%A0%B8%E5%90%AF%E5%8A%A8%E6%B5%81%E7%A8%8B/" id="article-nav-older" class="article-nav-link-wrap">
      <strong class="article-nav-caption">Older</strong>
      <div class="article-nav-title">Linux内核启动流程</div>
    </a>
  
</nav>

  
</article>


</section>
        
          <aside id="sidebar">
  
    

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Tags</h3>
    <div class="widget">
      <ul class="tag-list" itemprop="keywords"><li class="tag-list-item"><a class="tag-list-link" href="/tags/Linux%E8%AE%BE%E5%A4%87%E9%A9%B1%E5%8A%A8/" rel="tag">Linux设备驱动</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Makefile/" rel="tag">Makefile</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/arm%E6%B1%87%E7%BC%96/" rel="tag">arm汇编</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/arm%E8%A3%B8%E6%9C%BA/" rel="tag">arm裸机</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/boot%E5%90%AF%E5%8A%A8/" rel="tag">boot启动</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/ini%E8%A7%A3%E6%9E%90/" rel="tag">ini解析</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/linux%E5%86%85%E5%AD%98%E7%AE%A1%E7%90%86/" rel="tag">linux内存管理</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/linux%E5%86%85%E6%A0%B8/" rel="tag">linux内核</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/linux%E5%B5%8C%E5%85%A5%E5%BC%8F%E7%8E%AF%E5%A2%83%E6%90%AD%E5%BB%BA/" rel="tag">linux嵌入式环境搭建</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/linux%E7%B3%BB%E7%BB%9F%E6%9E%84%E5%BB%BA/" rel="tag">linux系统构建</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/mipi%E5%9B%BE%E5%83%8F%E5%A4%84%E7%90%86/" rel="tag">mipi图像处理</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/uboot/" rel="tag">uboot</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E4%B8%AD%E6%96%AD%E4%BD%93%E7%B3%BB/" rel="tag">中断体系</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E5%AD%97%E7%AC%A6%E7%BC%96%E7%A0%81/" rel="tag">字符编码</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E5%AD%98%E5%82%A8%E9%A9%B1%E5%8A%A8/" rel="tag">存储驱动</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E5%BC%80%E6%BA%90%E6%8F%92%E4%BB%B6/" rel="tag">开源插件</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/" rel="tag">数据结构</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E6%97%B6%E9%92%9F%E4%BD%93%E7%B3%BB/" rel="tag">时钟体系</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E8%A3%B8%E6%9C%BA%E5%A4%96%E8%AE%BE%E9%A9%B1%E5%8A%A8/" rel="tag">裸机外设驱动</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E9%80%9A%E4%BF%A1%E5%8D%8F%E8%AE%AE/" rel="tag">通信协议</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Tag Cloud</h3>
    <div class="widget tagcloud">
      <a href="/tags/Linux%E8%AE%BE%E5%A4%87%E9%A9%B1%E5%8A%A8/" style="font-size: 20px;">Linux设备驱动</a> <a href="/tags/Makefile/" style="font-size: 10px;">Makefile</a> <a href="/tags/arm%E6%B1%87%E7%BC%96/" style="font-size: 10px;">arm汇编</a> <a href="/tags/arm%E8%A3%B8%E6%9C%BA/" style="font-size: 18.18px;">arm裸机</a> <a href="/tags/boot%E5%90%AF%E5%8A%A8/" style="font-size: 16.36px;">boot启动</a> <a href="/tags/ini%E8%A7%A3%E6%9E%90/" style="font-size: 10px;">ini解析</a> <a href="/tags/linux%E5%86%85%E5%AD%98%E7%AE%A1%E7%90%86/" style="font-size: 10px;">linux内存管理</a> <a href="/tags/linux%E5%86%85%E6%A0%B8/" style="font-size: 15.45px;">linux内核</a> <a href="/tags/linux%E5%B5%8C%E5%85%A5%E5%BC%8F%E7%8E%AF%E5%A2%83%E6%90%AD%E5%BB%BA/" style="font-size: 17.27px;">linux嵌入式环境搭建</a> <a href="/tags/linux%E7%B3%BB%E7%BB%9F%E6%9E%84%E5%BB%BA/" style="font-size: 19.09px;">linux系统构建</a> <a href="/tags/mipi%E5%9B%BE%E5%83%8F%E5%A4%84%E7%90%86/" style="font-size: 11.82px;">mipi图像处理</a> <a href="/tags/uboot/" style="font-size: 14.55px;">uboot</a> <a href="/tags/%E4%B8%AD%E6%96%AD%E4%BD%93%E7%B3%BB/" style="font-size: 15.45px;">中断体系</a> <a href="/tags/%E5%AD%97%E7%AC%A6%E7%BC%96%E7%A0%81/" style="font-size: 10px;">字符编码</a> <a href="/tags/%E5%AD%98%E5%82%A8%E9%A9%B1%E5%8A%A8/" style="font-size: 10.91px;">存储驱动</a> <a href="/tags/%E5%BC%80%E6%BA%90%E6%8F%92%E4%BB%B6/" style="font-size: 12.73px;">开源插件</a> <a href="/tags/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/" style="font-size: 13.64px;">数据结构</a> <a href="/tags/%E6%97%B6%E9%92%9F%E4%BD%93%E7%B3%BB/" style="font-size: 10px;">时钟体系</a> <a href="/tags/%E8%A3%B8%E6%9C%BA%E5%A4%96%E8%AE%BE%E9%A9%B1%E5%8A%A8/" style="font-size: 16.36px;">裸机外设驱动</a> <a href="/tags/%E9%80%9A%E4%BF%A1%E5%8D%8F%E8%AE%AE/" style="font-size: 15.45px;">通信协议</a>
    </div>
  </div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Archives</h3>
    <div class="widget">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2024/09/">September 2024</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2024/08/">August 2024</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2024/07/">July 2024</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2024/06/">June 2024</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2024/05/">May 2024</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2024/04/">April 2024</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2024/03/">March 2024</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Recent Posts</h3>
    <div class="widget">
      <ul>
        
          <li>
            <a href="/2024/09/22/%E5%AD%97%E7%AC%A6%E8%AE%BE%E5%A4%87%E9%A9%B1%E5%8A%A8-IIO%E5%AD%90%E7%B3%BB%E7%BB%9F/">字符设备驱动-IIO子系统</a>
          </li>
        
          <li>
            <a href="/2024/09/22/%E5%AD%97%E7%AC%A6%E8%AE%BE%E5%A4%87%E9%A9%B1%E5%8A%A8-regmap%E5%AD%90%E7%B3%BB%E7%BB%9F/">字符设备驱动-regmap子系统</a>
          </li>
        
          <li>
            <a href="/2024/09/16/%E5%AD%97%E7%AC%A6%E8%AE%BE%E5%A4%87%E9%A9%B1%E5%8A%A8-UART%E5%AD%90%E7%B3%BB%E7%BB%9F/">字符设备驱动-UART子系统</a>
          </li>
        
          <li>
            <a href="/2024/09/16/%E5%AD%97%E7%AC%A6%E8%AE%BE%E5%A4%87%E9%A9%B1%E5%8A%A8-RTC%E5%AD%90%E7%B3%BB%E7%BB%9F/">字符设备驱动-RTC子系统</a>
          </li>
        
          <li>
            <a href="/2024/09/01/%E5%AD%97%E7%AC%A6%E8%AE%BE%E5%A4%87%E9%A9%B1%E5%8A%A8-Framebuffer%E5%AD%90%E7%B3%BB%E7%BB%9F/">字符设备驱动-Framebuffer子系统</a>
          </li>
        
      </ul>
    </div>
  </div>

  
</aside>
        
      </div>
      <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      
      &copy; 2024 John Doe<br>
      Powered by <a href="https://hexo.io/" target="_blank">Hexo</a>
    </div>
  </div>
</footer>

    </div>
    <nav id="mobile-nav">
  
    <a href="/" class="mobile-nav-link">Home</a>
  
    <a href="/archives" class="mobile-nav-link">Archives</a>
  
</nav>
    


<script src="/js/jquery-3.6.4.min.js"></script>



  
<script src="/fancybox/jquery.fancybox.min.js"></script>




<script src="/js/script.js"></script>





  </div>
</body>
</html>