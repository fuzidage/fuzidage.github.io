<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
  
  <title>字符设备驱动-内核led子系统 | Hexo</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
  <meta name="description" content="1 LED子系统介绍 1.1 代码框架分析 1.2 结构体描述 1.2.1 led_classdev 1.2.2 gpio_led     2 LED 驱动使能 3 Linux 内核自带 LED 驱动分析 3.1 gpio_led_probe 函数简析 3.1.1 create_gpio_led 3.1.2 开启关闭led     4 led子系统应用举例 4.1 dts编写 4.2 修">
<meta property="og:type" content="article">
<meta property="og:title" content="字符设备驱动-内核led子系统">
<meta property="og:url" content="http://example.com/2024/08/18/%E5%AD%97%E7%AC%A6%E8%AE%BE%E5%A4%87%E9%A9%B1%E5%8A%A8-%E5%86%85%E6%A0%B8led%E5%AD%90%E7%B3%BB%E7%BB%9F/index.html">
<meta property="og:site_name" content="Hexo">
<meta property="og:description" content="1 LED子系统介绍 1.1 代码框架分析 1.2 结构体描述 1.2.1 led_classdev 1.2.2 gpio_led     2 LED 驱动使能 3 Linux 内核自带 LED 驱动分析 3.1 gpio_led_probe 函数简析 3.1.1 create_gpio_led 3.1.2 开启关闭led     4 led子系统应用举例 4.1 dts编写 4.2 修">
<meta property="og:locale" content="en_US">
<meta property="og:image" content="http://example.com/2024/08/18/%E5%AD%97%E7%AC%A6%E8%AE%BE%E5%A4%87%E9%A9%B1%E5%8A%A8-%E5%86%85%E6%A0%B8led%E5%AD%90%E7%B3%BB%E7%BB%9F/1.png">
<meta property="og:image" content="http://example.com/2024/08/18/%E5%AD%97%E7%AC%A6%E8%AE%BE%E5%A4%87%E9%A9%B1%E5%8A%A8-%E5%86%85%E6%A0%B8led%E5%AD%90%E7%B3%BB%E7%BB%9F/2.png">
<meta property="og:image" content="http://example.com/2024/08/18/%E5%AD%97%E7%AC%A6%E8%AE%BE%E5%A4%87%E9%A9%B1%E5%8A%A8-%E5%86%85%E6%A0%B8led%E5%AD%90%E7%B3%BB%E7%BB%9F/3.png">
<meta property="og:image" content="http://example.com/2024/08/18/%E5%AD%97%E7%AC%A6%E8%AE%BE%E5%A4%87%E9%A9%B1%E5%8A%A8-%E5%86%85%E6%A0%B8led%E5%AD%90%E7%B3%BB%E7%BB%9F/4.png">
<meta property="og:image" content="http://example.com/2024/08/18/%E5%AD%97%E7%AC%A6%E8%AE%BE%E5%A4%87%E9%A9%B1%E5%8A%A8-%E5%86%85%E6%A0%B8led%E5%AD%90%E7%B3%BB%E7%BB%9F/5.png">
<meta property="og:image" content="http://example.com/2024/08/18/%E5%AD%97%E7%AC%A6%E8%AE%BE%E5%A4%87%E9%A9%B1%E5%8A%A8-%E5%86%85%E6%A0%B8led%E5%AD%90%E7%B3%BB%E7%BB%9F/6.png">
<meta property="og:image" content="http://example.com/2024/08/18/%E5%AD%97%E7%AC%A6%E8%AE%BE%E5%A4%87%E9%A9%B1%E5%8A%A8-%E5%86%85%E6%A0%B8led%E5%AD%90%E7%B3%BB%E7%BB%9F/7.png">
<meta property="og:image" content="http://example.com/2024/08/18/%E5%AD%97%E7%AC%A6%E8%AE%BE%E5%A4%87%E9%A9%B1%E5%8A%A8-%E5%86%85%E6%A0%B8led%E5%AD%90%E7%B3%BB%E7%BB%9F/8.png">
<meta property="og:image" content="http://example.com/2024/08/18/%E5%AD%97%E7%AC%A6%E8%AE%BE%E5%A4%87%E9%A9%B1%E5%8A%A8-%E5%86%85%E6%A0%B8led%E5%AD%90%E7%B3%BB%E7%BB%9F/9.png">
<meta property="og:image" content="http://example.com/2024/08/18/%E5%AD%97%E7%AC%A6%E8%AE%BE%E5%A4%87%E9%A9%B1%E5%8A%A8-%E5%86%85%E6%A0%B8led%E5%AD%90%E7%B3%BB%E7%BB%9F/10.png">
<meta property="og:image" content="http://example.com/2024/08/18/%E5%AD%97%E7%AC%A6%E8%AE%BE%E5%A4%87%E9%A9%B1%E5%8A%A8-%E5%86%85%E6%A0%B8led%E5%AD%90%E7%B3%BB%E7%BB%9F/11.png">
<meta property="article:published_time" content="2024-08-18T09:01:56.000Z">
<meta property="article:modified_time" content="2024-08-31T06:49:42.373Z">
<meta property="article:author" content="John Doe">
<meta property="article:tag" content="Linux设备驱动">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="http://example.com/2024/08/18/%E5%AD%97%E7%AC%A6%E8%AE%BE%E5%A4%87%E9%A9%B1%E5%8A%A8-%E5%86%85%E6%A0%B8led%E5%AD%90%E7%B3%BB%E7%BB%9F/1.png">
  
    <link rel="alternate" href="/atom.xml" title="Hexo" type="application/atom+xml">
  
  
    <link rel="shortcut icon" href="/favicon.png">
  
  
  
<link rel="stylesheet" href="/css/style.css">

  
    
<link rel="stylesheet" href="/fancybox/jquery.fancybox.min.css">

  
  
<meta name="generator" content="Hexo 7.1.1"></head>

<body>
  <div id="container">
    <div id="wrap">
      <header id="header">
  <div id="banner"></div>
  <div id="header-outer" class="outer">
    <div id="header-title" class="inner">
      <h1 id="logo-wrap">
        <a href="/" id="logo">Hexo</a>
      </h1>
      
    </div>
    <div id="header-inner" class="inner">
      <nav id="main-nav">
        <a id="main-nav-toggle" class="nav-icon"><span class="fa fa-bars"></span></a>
        
          <a class="main-nav-link" href="/">Home</a>
        
          <a class="main-nav-link" href="/archives">Archives</a>
        
      </nav>
      <nav id="sub-nav">
        
        
          <a class="nav-icon" href="/atom.xml" title="RSS Feed"><span class="fa fa-rss"></span></a>
        
        <a class="nav-icon nav-search-btn" title="Search"><span class="fa fa-search"></span></a>
      </nav>
      <div id="search-form-wrap">
        <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" class="search-form-input" placeholder="Search"><button type="submit" class="search-form-submit">&#xF002;</button><input type="hidden" name="sitesearch" value="http://example.com"></form>
      </div>
    </div>
  </div>
</header>

      <div class="outer">
        <section id="main"><article id="post-字符设备驱动-内核led子系统" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2024/08/18/%E5%AD%97%E7%AC%A6%E8%AE%BE%E5%A4%87%E9%A9%B1%E5%8A%A8-%E5%86%85%E6%A0%B8led%E5%AD%90%E7%B3%BB%E7%BB%9F/" class="article-date">
  <time class="dt-published" datetime="2024-08-18T09:01:56.000Z" itemprop="datePublished">2024-08-18</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 class="p-name article-title" itemprop="headline name">
      字符设备驱动-内核led子系统
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <div class="toc">

<!-- toc -->

<ul>
<li><a href="#1-led-zi-xi-tong-jie-shao">1 LED子系统介绍</a><ul>
<li><a href="#1-1-dai-ma-kuang-jia-fen-xi">1.1 代码框架分析</a></li>
<li><a href="#1-2-jie-gou-ti-miao-shu">1.2 结构体描述</a><ul>
<li><a href="#1-2-1-led-classdev">1.2.1 led_classdev</a></li>
<li><a href="#1-2-2-gpio-led">1.2.2 gpio_led</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#2-led-qu-dong-shi-neng">2 LED 驱动使能</a></li>
<li><a href="#3-linux-nei-he-zi-dai-led-qu-dong-fen-xi">3 Linux 内核自带 LED 驱动分析</a><ul>
<li><a href="#3-1-gpio-led-probe-han-shu-jian-xi">3.1 gpio_led_probe 函数简析</a><ul>
<li><a href="#3-1-1-create-gpio-led">3.1.1 create_gpio_led</a></li>
<li><a href="#3-1-2-kai-qi-guan-bi-led">3.1.2 开启关闭led</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#4-led-zi-xi-tong-ying-yong-ju-li">4 led子系统应用举例</a><ul>
<li><a href="#4-1-dts-bian-xie">4.1 dts编写</a></li>
<li><a href="#4-2-xiu-gai-gai-led-cheng-xi-tong-xin-tiao-deng">4.2 修改该led成系统心跳灯</a></li>
</ul>
</li>
<li><a href="#5-ji-yu-sysfs-cao-zuo-led-zi-xi-tong">5 基于sysfs操作led子系统</a><ul>
<li><a href="#5-1-dian-liang-led">5.1 点亮 LED</a></li>
<li><a href="#5-2-shan-shuo">5.2 闪烁</a></li>
<li><a href="#5-3-guan-bi-led">5.3 关闭 LED</a></li>
</ul>
</li>
</ul>
<!-- tocstop -->

</div>

<h1><span id="1-led-zi-xi-tong-jie-shao">1 LED子系统介绍</span><a href="#1-led-zi-xi-tong-jie-shao" class="header-anchor">#</a></h1><p>用来管理控制板子的led灯，比如系统心跳灯，普通的硬盘指示灯光，颜色灯，休眠唤醒灯等等。</p>
<p><img src="/2024/08/18/%E5%AD%97%E7%AC%A6%E8%AE%BE%E5%A4%87%E9%A9%B1%E5%8A%A8-%E5%86%85%E6%A0%B8led%E5%AD%90%E7%B3%BB%E7%BB%9F/1.png" alt="image"><br>led 子系统相关描述可在内核源码 <code>Documentation/leds/leds-class.txt </code>了解。</p>
<p>led 子系统是一个简单的 Linux 子系统 ，在目录 <code>/sys/class/leds</code> 下展示该子系统设备，每个设备都有自己的属性：<br><img src="/2024/08/18/%E5%AD%97%E7%AC%A6%E8%AE%BE%E5%A4%87%E9%A9%B1%E5%8A%A8-%E5%86%85%E6%A0%B8led%E5%AD%90%E7%B3%BB%E7%BB%9F/2.png" alt="image"></p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">brightness：设置 LED 亮度，范围 <span class="number">0</span> ~ max_brightness</span><br><span class="line">max_brightness：最大亮度（<span class="number">255</span> 或其他数字）</span><br><span class="line">trigger：触发方式，如 heartbeat、mmc0、backlight、gpio</span><br><span class="line">delay_off、delay_on：trigger为timer时，LED亮灭的时间，单位ms</span><br></pre></td></tr></table></figure>

<p><code>kernel/include/linux/leds.h</code></p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">enum</span> <span class="title">led_brightness</span> &#123;</span></span><br><span class="line">	LED_OFF  = <span class="number">0</span>,    <span class="comment">//全暗</span></span><br><span class="line">	LED_HALF = <span class="number">127</span>,  <span class="comment">//一半亮度</span></span><br><span class="line">	LED_FULL = <span class="number">255</span>,  <span class="comment">//最大亮度</span></span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<h2><span id="1-1-dai-ma-kuang-jia-fen-xi">1.1 代码框架分析</span><a href="#1-1-dai-ma-kuang-jia-fen-xi" class="header-anchor">#</a></h2><p><code>led-class.c</code> (led 子系统框架的入口)</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">维护 LED 子系统的所有 LED 设备，为 LED 设备提供注册操作函数: </span><br><span class="line"></span><br><span class="line">led_classdev_register()</span><br><span class="line">devm_led_classdev_register()</span><br><span class="line"></span><br><span class="line">注销操作函数:</span><br><span class="line">led_classdev_unregister()</span><br><span class="line">devm_led_classdev_unregister();</span><br><span class="line"></span><br><span class="line">电源管理的休眠和恢复操作函数: </span><br><span class="line">led_classdev_suspend()</span><br><span class="line">led_classdev_resume();</span><br><span class="line"></span><br><span class="line">用户态操作接口:brightness 、max_brightness</span><br></pre></td></tr></table></figure>
<p><code>led-core.c</code></p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">抽象出 LED 操作逻辑，封装成函数导出，供其它文件使用:</span><br><span class="line"></span><br><span class="line">led_init_core(): 核心初始化;</span><br><span class="line">led_blink_set(): 设置led闪烁时间:</span><br><span class="line">led_blink_set_oneshot() : 闪烁一次</span><br><span class="line">led_stop_software_blink() : led停止闪烁</span><br><span class="line">led_set_brightness() : 设置led的亮度</span><br><span class="line">led_update_brightness : 更新亮度</span><br><span class="line">led_sysfs_disable : 用户态关闭</span><br><span class="line">led_sysfs enable : 用户态打开</span><br><span class="line">leds_list : leds链表;</span><br><span class="line">leds_list_lock : leds链表锁</span><br></pre></td></tr></table></figure>
<p><code>led-triggers.c</code></p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">维护 LED 子系统的所有触发器，为触发器提供注册操作函数: </span><br><span class="line"></span><br><span class="line">led_trigger_register()</span><br><span class="line">devm_led_trigger_register()</span><br><span class="line">led_trigger_register_simple()</span><br><span class="line"></span><br><span class="line">注销操作函数: </span><br><span class="line">led_trigger_unregister()</span><br><span class="line">led_trigger_unregister_simple()</span><br><span class="line"></span><br><span class="line">以及其它触发器相关的操作函数</span><br></pre></td></tr></table></figure>
<p><code>ledtrig-timer.c、ledtrig-xxx.c</code></p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">以 ledtrig-timer.c 为例</span><br><span class="line"></span><br><span class="line">入口函数调用 led_trigger_register() 注册触发器，</span><br><span class="line">注册时候传入 led_trigger 结构体，里面有 activate 和 deactivate 成员函数指针，</span><br><span class="line">作用是生成 delay_on 、 delay_off 文件</span><br><span class="line"></span><br><span class="line">同时还提供 delay_on 和 delay_off 的用户态操作接口</span><br><span class="line">卸载时，使用 led_trigger_unregister() 注销触发器</span><br></pre></td></tr></table></figure>

<p><code>leds-gpio.c、leds-xxx.c</code></p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">以 leds-gpio.c 为例</span><br><span class="line"></span><br><span class="line">在通过设备树或者其它途径匹配到设备信息后，将调用 probe() 函数，</span><br><span class="line">然后再根据设备信息设置 led_classdev，</span><br><span class="line">最后调用 devm_led_classdev_register() 注册 LED 设备。</span><br></pre></td></tr></table></figure>

<p>对于驱动开发人员，LED框架已经有了，并不需要我们去熟悉，只要知道如何使用，它是如何与我们的硬件相关联的，只要熟悉<code>leds-gpio.c</code>。</p>
<h2><span id="1-2-jie-gou-ti-miao-shu">1.2 结构体描述</span><a href="#1-2-jie-gou-ti-miao-shu" class="header-anchor">#</a></h2><h3><span id="1-2-1-led-classdev">1.2.1 led_classdev</span><a href="#1-2-1-led-classdev" class="header-anchor">#</a></h3><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">led_classdev</span> &#123;</span></span><br><span class="line">	 <span class="type">const</span> <span class="type">char</span>  *name;<span class="comment">//名字</span></span><br><span class="line">	 <span class="class"><span class="keyword">enum</span> <span class="title">led_brightness</span>  <span class="title">brightness</span>;</span><span class="comment">//亮度</span></span><br><span class="line">	 <span class="class"><span class="keyword">enum</span> <span class="title">led_brightness</span>  <span class="title">max_brightness</span>;</span><span class="comment">//最大亮度</span></span><br><span class="line">	 <span class="type">int</span>    flags;</span><br><span class="line"></span><br><span class="line">	 <span class="comment">/* Lower 16 bits reflect status */</span></span><br><span class="line">	<span class="meta">#<span class="keyword">define</span> LED_SUSPENDED  (1 &lt;&lt; 0)</span></span><br><span class="line">	 <span class="comment">/* Upper 16 bits reflect control information */</span></span><br><span class="line">	<span class="meta">#<span class="keyword">define</span> LED_CORE_SUSPENDRESUME (1 &lt;&lt; 16)</span></span><br><span class="line">	<span class="meta">#<span class="keyword">define</span> LED_BLINK_ONESHOT (1 &lt;&lt; 17)</span></span><br><span class="line">	<span class="meta">#<span class="keyword">define</span> LED_BLINK_ONESHOT_STOP (1 &lt;&lt; 18)</span></span><br><span class="line">	<span class="meta">#<span class="keyword">define</span> LED_BLINK_INVERT (1 &lt;&lt; 19)</span></span><br><span class="line">	<span class="meta">#<span class="keyword">define</span> LED_SYSFS_DISABLE (1 &lt;&lt; 20)</span></span><br><span class="line">	<span class="meta">#<span class="keyword">define</span> SET_BRIGHTNESS_ASYNC (1 &lt;&lt; 21)</span></span><br><span class="line">	<span class="meta">#<span class="keyword">define</span> SET_BRIGHTNESS_SYNC (1 &lt;&lt; 22)</span></span><br><span class="line">	<span class="meta">#<span class="keyword">define</span> LED_DEV_CAP_FLASH (1 &lt;&lt; 23)</span></span><br><span class="line"></span><br><span class="line">	<span class="comment">//设置亮度API</span></span><br><span class="line">	 <span class="type">void</span>  (*brightness_set)(<span class="keyword">struct</span> led_classdev *led_cdev,<span class="keyword">enum</span> led_brightness brightness);</span><br><span class="line">	 <span class="type">int</span>  (*brightness_set_sync)(<span class="keyword">struct</span> led_classdev *led_cdev,<span class="keyword">enum</span> led_brightness brightness);</span><br><span class="line"></span><br><span class="line">	<span class="comment">//获取亮度API</span></span><br><span class="line">	 <span class="keyword">enum</span> <span class="title function_">led_brightness</span> <span class="params">(*brightness_get)</span><span class="params">(<span class="keyword">struct</span> led_classdev *led_cdev)</span>;</span><br><span class="line"></span><br><span class="line">	<span class="comment">//闪烁时点亮和熄灭的时间设置</span></span><br><span class="line">	 <span class="type">int</span>  (*blink_set)(<span class="keyword">struct</span> led_classdev *led_cdev,<span class="type">unsigned</span> <span class="type">long</span> *delay_on,<span class="type">unsigned</span> <span class="type">long</span> *delay_off);</span><br><span class="line"></span><br><span class="line">	 <span class="class"><span class="keyword">struct</span> <span class="title">device</span>  *<span class="title">dev</span>;</span></span><br><span class="line">	 <span class="type">const</span> <span class="class"><span class="keyword">struct</span> <span class="title">attribute_group</span> **<span class="title">groups</span>;</span></span><br><span class="line"></span><br><span class="line">	<span class="comment">//leds-list的node</span></span><br><span class="line">	 <span class="class"><span class="keyword">struct</span> <span class="title">list_head</span>  <span class="title">node</span>;</span></span><br><span class="line">	<span class="comment">//默认trigger的名字</span></span><br><span class="line">	 <span class="type">const</span> <span class="type">char</span>  *default_trigger;</span><br><span class="line">	<span class="comment">//闪烁的开关时间</span></span><br><span class="line">	 <span class="type">unsigned</span> <span class="type">long</span>   blink_delay_on, blink_delay_off;</span><br><span class="line">	<span class="comment">//闪烁的定时器链表</span></span><br><span class="line">	 <span class="class"><span class="keyword">struct</span> <span class="title">timer_list</span>  <span class="title">blink_timer</span>;</span></span><br><span class="line">	<span class="comment">//闪烁的亮度</span></span><br><span class="line">	 <span class="type">int</span>    blink_brightness;</span><br><span class="line">	 <span class="type">void</span>   (*flash_resume)(<span class="keyword">struct</span> led_classdev *led_cdev);</span><br><span class="line"></span><br><span class="line">	 <span class="class"><span class="keyword">struct</span> <span class="title">work_struct</span> <span class="title">set_brightness_work</span>;</span></span><br><span class="line">	 <span class="type">int</span>   delayed_set_value;</span><br><span class="line"></span><br><span class="line">	<span class="meta">#<span class="keyword">ifdef</span> CONFIG_LEDS_TRIGGERS</span></span><br><span class="line">	<span class="comment">//trigger的锁</span></span><br><span class="line">	 <span class="class"><span class="keyword">struct</span> <span class="title">rw_semaphore</span>  <span class="title">trigger_lock</span>;</span></span><br><span class="line">	<span class="comment">//led的trigger</span></span><br><span class="line">	 <span class="class"><span class="keyword">struct</span> <span class="title">led_trigger</span> *<span class="title">trigger</span>;</span></span><br><span class="line">	<span class="comment">//trigger的链表</span></span><br><span class="line">	 <span class="class"><span class="keyword">struct</span> <span class="title">list_head</span>  <span class="title">trig_list</span>;</span></span><br><span class="line">	<span class="comment">//trigger的数据</span></span><br><span class="line">	 <span class="type">void</span>   *trigger_data;</span><br><span class="line">	 <span class="type">bool</span>   activated;</span><br><span class="line">	<span class="meta">#<span class="keyword">endif</span></span></span><br><span class="line">	 <span class="class"><span class="keyword">struct</span> <span class="title">mutex</span>  <span class="title">led_access</span>;</span></span><br><span class="line">	&#125;;</span><br></pre></td></tr></table></figure>
<h3><span id="1-2-2-gpio-led">1.2.2 gpio_led</span><a href="#1-2-2-gpio-led" class="header-anchor">#</a></h3><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">gpio_led</span> &#123;</span></span><br><span class="line">	<span class="type">const</span> <span class="type">char</span> *name;</span><br><span class="line">	<span class="type">const</span> <span class="type">char</span> *default_trigger;</span><br><span class="line">	<span class="type">unsigned</span> 	gpio;</span><br><span class="line">	<span class="type">unsigned</span>	active_low : <span class="number">1</span>;</span><br><span class="line">	<span class="type">unsigned</span>	retain_state_suspended : <span class="number">1</span>;</span><br><span class="line">	<span class="type">unsigned</span>	panic_indicator : <span class="number">1</span>;</span><br><span class="line">	<span class="type">unsigned</span>	default_state : <span class="number">2</span>;</span><br><span class="line">	<span class="comment">/* default_state should be one of LEDS_GPIO_DEFSTATE_(ON|OFF|KEEP) */</span></span><br><span class="line">	<span class="class"><span class="keyword">struct</span> <span class="title">gpio_desc</span> *<span class="title">gpiod</span>;</span></span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<p><code>name</code>: led名字<br><code>default_trigger</code>:  LED 灯在Linux 系统中的默认功能，比如作为系统心跳指示灯等等。<br><code>default_state</code>: 默认状态，如：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">#define LEDS_GPIO_DEFSTATE_OFF		0</span><br><span class="line">#define LEDS_GPIO_DEFSTATE_ON		1</span><br><span class="line">#define LEDS_GPIO_DEFSTATE_KEEP		2</span><br></pre></td></tr></table></figure>
<p><code>gpiod</code>：是gpio描述，详见<a target="_blank" rel="noopener" href="https://www.cnblogs.com/fuzidage/p/18085417">linux内核驱动-gpio子系统 - fuzidage - 博客园 (cnblogs.com)</a></p>
<p><a target="_blank" rel="noopener" href="https://fuzidage.github.io/2024/08/17/%E5%AD%97%E7%AC%A6%E8%AE%BE%E5%A4%87%E9%A9%B1%E5%8A%A8-gpio%E5%AD%90%E7%B3%BB%E7%BB%9F/">字符设备驱动-gpio子系统 | Hexo (fuzidage.github.io)</a></p>
<h1><span id="2-led-qu-dong-shi-neng">2 LED 驱动使能</span><a href="#2-led-qu-dong-shi-neng" class="header-anchor">#</a></h1><p>输入<code>make menuconfig</code></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">-&gt; Device Drivers</span><br><span class="line">	-&gt; LED Support (NEW_LEDS [=y])</span><br><span class="line">		-&gt;LED Support <span class="keyword">for</span> GPIO connected LEDs</span><br></pre></td></tr></table></figure>

<p><img src="/2024/08/18/%E5%AD%97%E7%AC%A6%E8%AE%BE%E5%A4%87%E9%A9%B1%E5%8A%A8-%E5%86%85%E6%A0%B8led%E5%AD%90%E7%B3%BB%E7%BB%9F/3.png" alt="image"><br>可 以 看 出 ， 把 Linux 内 部 自 带 的 LED 灯 驱 动 编 译 进 内 核 以 后，<code>CONFIG_LEDS_GPIO</code> 就会等于‘y’：<br><img src="/2024/08/18/%E5%AD%97%E7%AC%A6%E8%AE%BE%E5%A4%87%E9%A9%B1%E5%8A%A8-%E5%86%85%E6%A0%B8led%E5%AD%90%E7%B3%BB%E7%BB%9F/4.png" alt="image"></p>
<h1><span id="3-linux-nei-he-zi-dai-led-qu-dong-fen-xi">3 Linux 内核自带 LED 驱动分析</span><a href="#3-linux-nei-he-zi-dai-led-qu-dong-fen-xi" class="header-anchor">#</a></h1><p>LED 灯驱动文件为<code>/drivers/leds/leds-gpio.c</code>，大家可以打开<code>/drivers/leds/Makefile</code> 这个文件：<br><img src="/2024/08/18/%E5%AD%97%E7%AC%A6%E8%AE%BE%E5%A4%87%E9%A9%B1%E5%8A%A8-%E5%86%85%E6%A0%B8led%E5%AD%90%E7%B3%BB%E7%BB%9F/5.png" alt="image"><br>来看一下<code>leds-gpio.c</code>这个驱动文件：</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">static</span> <span class="type">const</span> <span class="class"><span class="keyword">struct</span> <span class="title">of_device_id</span> <span class="title">of_gpio_leds_match</span>[] =</span> &#123;</span><br><span class="line">	&#123; .compatible = <span class="string">&quot;gpio-leds&quot;</span>, &#125;,</span><br><span class="line">	&#123;&#125;,</span><br><span class="line">&#125;;</span><br><span class="line">......</span><br><span class="line"><span class="type">static</span> <span class="class"><span class="keyword">struct</span> <span class="title">platform_driver</span> <span class="title">gpio_led_driver</span> =</span> &#123;</span><br><span class="line">	.probe = gpio_led_probe,</span><br><span class="line">	.remove = gpio_led_remove,</span><br><span class="line">	.driver = &#123;</span><br><span class="line">	.name = <span class="string">&quot;leds-gpio&quot;</span>,</span><br><span class="line">	.of_match_table = of_gpio_leds_match,</span><br><span class="line">	&#125;,</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">module_platform_driver(gpio_led_driver);</span><br></pre></td></tr></table></figure>

<p>LED 驱动的匹配表，此表只有一个匹配项，<code>compatible</code> 内容为<code>“gpio-leds”</code>，<br>因此设备树中的 LED 灯设备节点的 <code>compatible </code>属性值也要为<code>“gpio-leds”</code>，否则设备和驱动匹<br>配不成功，驱动就没法工作。</p>
<p>利用内核自带LED子系统驱动，可以帮我们很好的控制板子产品的指示灯，不需要单独编写驱动程序。</p>
<h2><span id="3-1-gpio-led-probe-han-shu-jian-xi">3.1 gpio_led_probe 函数简析</span><a href="#3-1-gpio-led-probe-han-shu-jian-xi" class="header-anchor">#</a></h2><p><img src="/2024/08/18/%E5%AD%97%E7%AC%A6%E8%AE%BE%E5%A4%87%E9%A9%B1%E5%8A%A8-%E5%86%85%E6%A0%B8led%E5%AD%90%E7%B3%BB%E7%BB%9F/6.png" alt="image"><br>进入probe函数，pdata此时为空，<strong>进入gpio_leds_create</strong>：<br><img src="/2024/08/18/%E5%AD%97%E7%AC%A6%E8%AE%BE%E5%A4%87%E9%A9%B1%E5%8A%A8-%E5%86%85%E6%A0%B8led%E5%AD%90%E7%B3%BB%E7%BB%9F/7.png" alt="image"></p>
<ol>
<li>调用 <code>device_get_child_node_count</code> 函数统计子节点数量，一般在在设备树中创建<br>一个节点表示 LED 灯，然后在这个节点下面为每个 LED 灯创建一个子节点。因此子节点数量也是 LED 灯的数量。</li>
<li>遍历每个子节点，获取每个子节点的信息：<br> 2.1 <code>devm_get_gpiod_from_child</code>获取每个gpio灯的<code>gpio_desc</code>信息。<br> 2.2 获取<code>label</code>属性，<code>label</code>作为led的名字<br> 2.3 获取<code>“linux,default-trigger”</code>属性，可以通过此属性设置某个 LED 灯在Linux 系统中的默认功能，比如作为系统心跳指示灯等等。<br> 2.4 获取<code>“default-state”</code>属性值，也就是 LED 灯的默认状态属性<br> 2.5 <code>create_gpio_led </code>函数创建 LED 相关的 io，常用gpio操作，下面详细介绍</li>
</ol>
<h3><span id="3-1-1-create-gpio-led">3.1.1 create_gpio_led</span><a href="#3-1-1-create-gpio-led" class="header-anchor">#</a></h3><p><img src="/2024/08/18/%E5%AD%97%E7%AC%A6%E8%AE%BE%E5%A4%87%E9%A9%B1%E5%8A%A8-%E5%86%85%E6%A0%B8led%E5%AD%90%E7%B3%BB%E7%BB%9F/8.png" alt="image"></p>
<ol>
<li>先获取<code>gpiod</code>信息</li>
<li>配置<code>led_dat</code>属性，包括<code>default_state, brightness</code>等信息</li>
<li>配置<code>gpio</code>方向</li>
<li>将led注册给LED子系统</li>
</ol>
<h3><span id="3-1-2-kai-qi-guan-bi-led">3.1.2 开启关闭led</span><a href="#3-1-2-kai-qi-guan-bi-led" class="header-anchor">#</a></h3><p><img src="/2024/08/18/%E5%AD%97%E7%AC%A6%E8%AE%BE%E5%A4%87%E9%A9%B1%E5%8A%A8-%E5%86%85%E6%A0%B8led%E5%AD%90%E7%B3%BB%E7%BB%9F/9.png" alt="image"></p>
<h1><span id="4-led-zi-xi-tong-ying-yong-ju-li">4 led子系统应用举例</span><a href="#4-led-zi-xi-tong-ying-yong-ju-li" class="header-anchor">#</a></h1><h2><span id="4-1-dts-bian-xie">4.1 dts编写</span><a href="#4-1-dts-bian-xie" class="header-anchor">#</a></h2><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">dtsleds &#123;</span><br><span class="line">	compatible = <span class="string">&quot;gpio-leds&quot;</span>;</span><br><span class="line">	led0 &#123;</span><br><span class="line">		label = <span class="string">&quot;red&quot;</span>;</span><br><span class="line">		gpios = &lt;&amp;gpio1 <span class="number">3</span> GPIO_ACTIVE_LOW&gt;;</span><br><span class="line">		<span class="keyword">default</span>-state = <span class="string">&quot;off&quot;</span>;</span><br><span class="line">	&#125;;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<p>创建一个节点表示 LED 灯设备，比如<code> dtsleds</code>，如果板子上有多个 LED 灯的话每个 LED灯都作为 <code>dtsleds</code> 的子节点。</p>
<ol>
<li><code>dtsleds </code>节点的<code>compatible</code>属性值一定要为<code>“gpio-leds”</code>。</li>
<li>设置<code>label</code>属性，此属性为可选，每个子节点都有一个 label 属性，label 属性一般表示LED 灯的名字，比如以颜色区分的话就是 red、green 等等。</li>
<li>每个子节点必须要设置<code>gpios</code>属性值，表示此 LED 所使用的 GPIO 引脚！</li>
<li>可以设置<code>“linux,default-trigger”</code>属性值，也就是设置 LED 灯的默认功能，可以查阅<code>Documentation/devicetree/bindings/leds/common.txt </code>这个文档来查看可选功能，比如：<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">backlight：LED 灯作为背光。</span><br><span class="line"><span class="keyword">default</span>-on：LED 灯打开</span><br><span class="line">heartbeat：LED 灯作为心跳指示灯，可以作为系统运行提示灯。</span><br><span class="line">ide-disk：LED 灯作为硬盘活动指示灯。</span><br><span class="line">timer：LED 灯周期性闪烁，由定时器驱动，闪烁频率可以修改</span><br></pre></td></tr></table></figure></li>
<li>可以设置<code>“default-state”</code>属性值，可以设置为 on、off 或 keep，为 on 的时候 LED 灯默认打开，为 off 的话 LED 灯默认关闭，为 keep 的话 LED 灯保持当前模式</li>
</ol>
<p>启动开发板：<br><img src="/2024/08/18/%E5%AD%97%E7%AC%A6%E8%AE%BE%E5%A4%87%E9%A9%B1%E5%8A%A8-%E5%86%85%E6%A0%B8led%E5%AD%90%E7%B3%BB%E7%BB%9F/10.png" alt="image"><br>进入到 leds 目录中：<br><img src="/2024/08/18/%E5%AD%97%E7%AC%A6%E8%AE%BE%E5%A4%87%E9%A9%B1%E5%8A%A8-%E5%86%85%E6%A0%B8led%E5%AD%90%E7%B3%BB%E7%BB%9F/11.png" alt="image"><br>测试：</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">echo <span class="number">1</span> &gt; /sys/<span class="class"><span class="keyword">class</span>/<span class="title">leds</span>/<span class="title">red</span>/<span class="title">brightness</span> //打开 <span class="title">LED0</span></span></span><br><span class="line"><span class="class"><span class="title">echo</span> 0 &gt;</span> /sys/<span class="class"><span class="keyword">class</span>/<span class="title">leds</span>/<span class="title">red</span>/<span class="title">brightness</span> //关闭 <span class="title">LED0</span></span></span><br></pre></td></tr></table></figure>
<p>如果能正常的打开和关闭 LED 灯话就说明使用led子系统ok。</p>
<h2><span id="4-2-xiu-gai-gai-led-cheng-xi-tong-xin-tiao-deng">4.2 修改该led成系统心跳灯</span><a href="#4-2-xiu-gai-gai-led-cheng-xi-tong-xin-tiao-deng" class="header-anchor">#</a></h2><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">dtsleds &#123;</span><br><span class="line">	compatible = <span class="string">&quot;gpio-leds&quot;</span>;</span><br><span class="line">	led0 &#123;</span><br><span class="line">		label = <span class="string">&quot;red&quot;</span>;</span><br><span class="line">		gpios = &lt;&amp;gpio1 <span class="number">3</span> GPIO_ACTIVE_LOW&gt;;</span><br><span class="line">		linux,<span class="keyword">default</span>-trigger = <span class="string">&quot;heartbeat&quot;</span>;</span><br><span class="line">		<span class="keyword">default</span>-state = <span class="string">&quot;on&quot;</span>;</span><br><span class="line">	&#125;;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<p>设置 LED0 为<code> heartbeat</code>。<br>第 8 行，默认打开 LED0。</p>
<h1><span id="5-ji-yu-sysfs-cao-zuo-led-zi-xi-tong">5 基于sysfs操作led子系统</span><a href="#5-ji-yu-sysfs-cao-zuo-led-zi-xi-tong" class="header-anchor">#</a></h1><h2><span id="5-1-dian-liang-led">5.1 点亮 LED</span><a href="#5-1-dian-liang-led" class="header-anchor">#</a></h2><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">echo <span class="number">255</span> &gt; /sys/<span class="class"><span class="keyword">class</span>/<span class="title">leds</span>/<span class="title">led1</span>/<span class="title">brightness</span></span></span><br><span class="line"><span class="class"><span class="title">cat</span> /<span class="title">sys</span>/<span class="keyword">class</span>/<span class="title">leds</span>/<span class="title">led1</span>/<span class="title">brightness</span></span></span><br><span class="line"><span class="class"><span class="title">cat</span> /<span class="title">sys</span>/<span class="keyword">class</span>/<span class="title">leds</span>/<span class="title">led1</span>/<span class="title">max_brightness</span></span></span><br></pre></td></tr></table></figure>
<h2><span id="5-2-shan-shuo">5.2 闪烁</span><a href="#5-2-shan-shuo" class="header-anchor">#</a></h2><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">cat /sys/<span class="class"><span class="keyword">class</span>/<span class="title">leds</span>/<span class="title">led1</span>/<span class="title">trigger</span></span></span><br><span class="line"><span class="class"></span></span><br><span class="line"><span class="class">会看到 <span class="title">trigger_list</span></span></span><br><span class="line"><span class="class">[<span class="title">none</span>] <span class="title">mmc0</span> <span class="title">mmc1</span> <span class="title">mmc2</span> <span class="title">timer</span></span></span><br><span class="line"><span class="class">其中的 <span class="title">timer</span> 这个 <span class="title">trigger</span> 是 <span class="title">ledtrig</span>-<span class="title">timer</span>.<span class="title">c</span> 中模块初始化的时候注册进去的</span></span><br><span class="line"><span class="class"></span></span><br><span class="line"><span class="class"><span class="title">echo</span> <span class="title">timer</span> &gt;</span> /sys/<span class="class"><span class="keyword">class</span>/<span class="title">leds</span>/<span class="title">led1</span>/<span class="title">trigger</span></span></span><br><span class="line"><span class="class">这一句会调用</span></span><br><span class="line"><span class="class"><span class="title">led_trigger_store</span>()-&gt;</span></span><br><span class="line">   led_trigger_set()-&gt;</span><br><span class="line">     trigger-&gt;activate(led_cdev);</span><br><span class="line">从而调用 ledtrig-timer.c 文件里 的timer_trig_activate()，</span><br><span class="line">在 /sys/<span class="class"><span class="keyword">class</span>/<span class="title">leds</span>/<span class="title">led1</span>/ 下创建 <span class="title">delay_on</span>、<span class="title">delay_off</span> 两个文件</span></span><br><span class="line"><span class="class"></span></span><br><span class="line"><span class="class"><span class="title">echo</span> 100 &gt;</span> /sys/<span class="class"><span class="keyword">class</span>/<span class="title">leds</span>/<span class="title">led1</span>/<span class="title">delay_on</span></span></span><br><span class="line"><span class="class"><span class="title">echo</span> 200 &gt;</span> /sys/<span class="class"><span class="keyword">class</span>/<span class="title">leds</span>/<span class="title">led1</span>/<span class="title">delay_off</span></span></span><br><span class="line"><span class="class">这样会闪烁，亮 100<span class="title">ms</span> 灭 200<span class="title">ms</span></span></span><br></pre></td></tr></table></figure>
<h2><span id="5-3-guan-bi-led">5.3 关闭 LED</span><a href="#5-3-guan-bi-led" class="header-anchor">#</a></h2><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">echo <span class="number">0</span> &gt; /sys/<span class="class"><span class="keyword">class</span>/<span class="title">leds</span>/<span class="title">led1</span>/<span class="title">delay_on</span></span></span><br><span class="line"><span class="class">或</span></span><br><span class="line"><span class="class"><span class="title">echo</span> 0 &gt;</span> /sys/<span class="class"><span class="keyword">class</span>/<span class="title">leds</span>/<span class="title">led1</span>/<span class="title">brightness</span></span></span><br></pre></td></tr></table></figure>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/2024/08/18/%E5%AD%97%E7%AC%A6%E8%AE%BE%E5%A4%87%E9%A9%B1%E5%8A%A8-%E5%86%85%E6%A0%B8led%E5%AD%90%E7%B3%BB%E7%BB%9F/" data-id="cm0dxg14n004sdsuf7ra06ors" data-title="字符设备驱动-内核led子系统" class="article-share-link"><span class="fa fa-share">Share</span></a>
      
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Linux%E8%AE%BE%E5%A4%87%E9%A9%B1%E5%8A%A8/" rel="tag">Linux设备驱动</a></li></ul>

    </footer>
  </div>
  
    
<nav id="article-nav">
  
    <a href="/2024/08/25/%E5%AD%97%E7%AC%A6%E8%AE%BE%E5%A4%87%E9%A9%B1%E5%8A%A8-I2C%E5%AD%90%E7%B3%BB%E7%BB%9F/" id="article-nav-newer" class="article-nav-link-wrap">
      <strong class="article-nav-caption">Newer</strong>
      <div class="article-nav-title">
        
          字符设备驱动-I2C子系统
        
      </div>
    </a>
  
  
    <a href="/2024/08/18/%E5%AD%97%E7%AC%A6%E8%AE%BE%E5%A4%87%E9%A9%B1%E5%8A%A8-pinctrl%E5%AD%90%E7%B3%BB%E7%BB%9F/" id="article-nav-older" class="article-nav-link-wrap">
      <strong class="article-nav-caption">Older</strong>
      <div class="article-nav-title">字符设备驱动-pinctrl子系统</div>
    </a>
  
</nav>

  
</article>


</section>
        
          <aside id="sidebar">
  
    

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Tags</h3>
    <div class="widget">
      <ul class="tag-list" itemprop="keywords"><li class="tag-list-item"><a class="tag-list-link" href="/tags/Linux%E8%AE%BE%E5%A4%87%E9%A9%B1%E5%8A%A8/" rel="tag">Linux设备驱动</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Makefile/" rel="tag">Makefile</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/arm%E6%B1%87%E7%BC%96/" rel="tag">arm汇编</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/arm%E8%A3%B8%E6%9C%BA/" rel="tag">arm裸机</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/boot%E5%90%AF%E5%8A%A8/" rel="tag">boot启动</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/ini%E8%A7%A3%E6%9E%90/" rel="tag">ini解析</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/linux%E5%86%85%E5%AD%98%E7%AE%A1%E7%90%86/" rel="tag">linux内存管理</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/linux%E5%86%85%E6%A0%B8/" rel="tag">linux内核</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/linux%E5%B5%8C%E5%85%A5%E5%BC%8F%E7%8E%AF%E5%A2%83%E6%90%AD%E5%BB%BA/" rel="tag">linux嵌入式环境搭建</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/linux%E7%B3%BB%E7%BB%9F%E6%9E%84%E5%BB%BA/" rel="tag">linux系统构建</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/mipi%E5%9B%BE%E5%83%8F%E5%A4%84%E7%90%86/" rel="tag">mipi图像处理</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/uboot/" rel="tag">uboot</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E4%B8%AD%E6%96%AD%E4%BD%93%E7%B3%BB/" rel="tag">中断体系</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E5%AD%97%E7%AC%A6%E7%BC%96%E7%A0%81/" rel="tag">字符编码</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E5%AD%98%E5%82%A8%E9%A9%B1%E5%8A%A8/" rel="tag">存储驱动</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E5%BC%80%E6%BA%90%E6%8F%92%E4%BB%B6/" rel="tag">开源插件</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/" rel="tag">数据结构</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E6%97%B6%E9%92%9F%E4%BD%93%E7%B3%BB/" rel="tag">时钟体系</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E8%A3%B8%E6%9C%BA%E5%A4%96%E8%AE%BE%E9%A9%B1%E5%8A%A8/" rel="tag">裸机外设驱动</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E9%80%9A%E4%BF%A1%E5%8D%8F%E8%AE%AE/" rel="tag">通信协议</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Tag Cloud</h3>
    <div class="widget tagcloud">
      <a href="/tags/Linux%E8%AE%BE%E5%A4%87%E9%A9%B1%E5%8A%A8/" style="font-size: 20px;">Linux设备驱动</a> <a href="/tags/Makefile/" style="font-size: 10px;">Makefile</a> <a href="/tags/arm%E6%B1%87%E7%BC%96/" style="font-size: 10px;">arm汇编</a> <a href="/tags/arm%E8%A3%B8%E6%9C%BA/" style="font-size: 18.18px;">arm裸机</a> <a href="/tags/boot%E5%90%AF%E5%8A%A8/" style="font-size: 16.36px;">boot启动</a> <a href="/tags/ini%E8%A7%A3%E6%9E%90/" style="font-size: 10px;">ini解析</a> <a href="/tags/linux%E5%86%85%E5%AD%98%E7%AE%A1%E7%90%86/" style="font-size: 10px;">linux内存管理</a> <a href="/tags/linux%E5%86%85%E6%A0%B8/" style="font-size: 15.45px;">linux内核</a> <a href="/tags/linux%E5%B5%8C%E5%85%A5%E5%BC%8F%E7%8E%AF%E5%A2%83%E6%90%AD%E5%BB%BA/" style="font-size: 17.27px;">linux嵌入式环境搭建</a> <a href="/tags/linux%E7%B3%BB%E7%BB%9F%E6%9E%84%E5%BB%BA/" style="font-size: 19.09px;">linux系统构建</a> <a href="/tags/mipi%E5%9B%BE%E5%83%8F%E5%A4%84%E7%90%86/" style="font-size: 11.82px;">mipi图像处理</a> <a href="/tags/uboot/" style="font-size: 14.55px;">uboot</a> <a href="/tags/%E4%B8%AD%E6%96%AD%E4%BD%93%E7%B3%BB/" style="font-size: 15.45px;">中断体系</a> <a href="/tags/%E5%AD%97%E7%AC%A6%E7%BC%96%E7%A0%81/" style="font-size: 10px;">字符编码</a> <a href="/tags/%E5%AD%98%E5%82%A8%E9%A9%B1%E5%8A%A8/" style="font-size: 10.91px;">存储驱动</a> <a href="/tags/%E5%BC%80%E6%BA%90%E6%8F%92%E4%BB%B6/" style="font-size: 12.73px;">开源插件</a> <a href="/tags/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/" style="font-size: 13.64px;">数据结构</a> <a href="/tags/%E6%97%B6%E9%92%9F%E4%BD%93%E7%B3%BB/" style="font-size: 10px;">时钟体系</a> <a href="/tags/%E8%A3%B8%E6%9C%BA%E5%A4%96%E8%AE%BE%E9%A9%B1%E5%8A%A8/" style="font-size: 16.36px;">裸机外设驱动</a> <a href="/tags/%E9%80%9A%E4%BF%A1%E5%8D%8F%E8%AE%AE/" style="font-size: 14.55px;">通信协议</a>
    </div>
  </div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Archives</h3>
    <div class="widget">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2024/09/">September 2024</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2024/08/">August 2024</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2024/07/">July 2024</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2024/06/">June 2024</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2024/05/">May 2024</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2024/04/">April 2024</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2024/03/">March 2024</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Recent Posts</h3>
    <div class="widget">
      <ul>
        
          <li>
            <a href="/2024/09/01/%E5%AD%97%E7%AC%A6%E8%AE%BE%E5%A4%87%E9%A9%B1%E5%8A%A8-Framebuffer%E5%AD%90%E7%B3%BB%E7%BB%9F/">字符设备驱动-Framebuffer子系统</a>
          </li>
        
          <li>
            <a href="/2024/09/01/%E5%AD%97%E7%AC%A6%E8%AE%BE%E5%A4%87%E9%A9%B1%E5%8A%A8-PWM%E5%AD%90%E7%B3%BB%E7%BB%9F/">字符设备驱动-PWM子系统</a>
          </li>
        
          <li>
            <a href="/2024/08/25/%E5%AD%97%E7%AC%A6%E8%AE%BE%E5%A4%87%E9%A9%B1%E5%8A%A8-input%E5%AD%90%E7%B3%BB%E7%BB%9F/">字符设备驱动-input子系统</a>
          </li>
        
          <li>
            <a href="/2024/08/25/%E5%AD%97%E7%AC%A6%E8%AE%BE%E5%A4%87%E9%A9%B1%E5%8A%A8-SPI%E5%AD%90%E7%B3%BB%E7%BB%9F/">字符设备驱动-SPI子系统</a>
          </li>
        
          <li>
            <a href="/2024/08/25/%E5%AD%97%E7%AC%A6%E8%AE%BE%E5%A4%87%E9%A9%B1%E5%8A%A8-I2C%E5%AD%90%E7%B3%BB%E7%BB%9F/">字符设备驱动-I2C子系统</a>
          </li>
        
      </ul>
    </div>
  </div>

  
</aside>
        
      </div>
      <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      
      &copy; 2024 John Doe<br>
      Powered by <a href="https://hexo.io/" target="_blank">Hexo</a>
    </div>
  </div>
</footer>

    </div>
    <nav id="mobile-nav">
  
    <a href="/" class="mobile-nav-link">Home</a>
  
    <a href="/archives" class="mobile-nav-link">Archives</a>
  
</nav>
    


<script src="/js/jquery-3.6.4.min.js"></script>



  
<script src="/fancybox/jquery.fancybox.min.js"></script>




<script src="/js/script.js"></script>





  </div>
</body>
</html>